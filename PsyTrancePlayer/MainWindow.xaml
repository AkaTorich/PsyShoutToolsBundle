<Window x:Class="PsyTrancePlayer.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:views="clr-namespace:PsyTrancePlayer.Views"
        xmlns:converters="clr-namespace:PsyTrancePlayer.Converters"
        xmlns:vm="clr-namespace:PsyTrancePlayer.ViewModels"
        Title="PsyTrance Player" Height="700" Width="1200"
        WindowStartupLocation="CenterScreen"
        Background="{StaticResource DarkBackgroundBrush}">

    <Window.DataContext>
        <vm:MainViewModel/>
    </Window.DataContext>

    <Window.Resources>
        <converters:TimeSpanConverter x:Key="TimeConverter"/>
    </Window.Resources>

    <Grid ClipToBounds="False">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="#1A1A2E" Padding="20,15">
            <Border.CacheMode>
                <BitmapCache RenderAtScale="1"/>
            </Border.CacheMode>
            <Border.Effect>
                <DropShadowEffect Color="#B026FF" BlurRadius="8" ShadowDepth="0" Opacity="0.3"/>
            </Border.Effect>
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0">
                    <TextBlock Text="{Binding CurrentTrack.Title, FallbackValue='No Track Playing'}"
                               FontSize="26"
                               FontWeight="Bold"
                               Style="{StaticResource PulseText}"/>
                    <TextBlock Text="{Binding CurrentTrack.Artist, FallbackValue='Select a track to start'}"
                               FontSize="16"
                               Style="{StaticResource GlowTextPink}"
                               Margin="0,5,0,0"/>
                </StackPanel>

                <Border Grid.Column="1"
                        Background="{StaticResource PsyGradient}"
                        CornerRadius="15"
                        Padding="20,10"
                        VerticalAlignment="Center">
                    <Border.CacheMode>
                        <BitmapCache RenderAtScale="1"/>
                    </Border.CacheMode>
                    <Border.Effect>
                        <DropShadowEffect Color="#FF1493" BlurRadius="6" ShadowDepth="0" Opacity="0.6"/>
                    </Border.Effect>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="BPM:"
                                   FontSize="16"
                                   FontWeight="Bold"
                                   Foreground="White"
                                   VerticalAlignment="Center"/>
                        <TextBlock Text="{Binding CurrentTrack.BPM, FallbackValue='--'}"
                                   FontSize="28"
                                   FontWeight="Bold"
                                   Foreground="White"
                                   Margin="10,0,0,0"/>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>

        <!-- Main Content -->
        <Grid Grid.Row="1" Margin="10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="10"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Visualizer -->
            <Border Grid.Column="0"
                    Background="#0F0F1A"
                    CornerRadius="10"
                    BorderThickness="2"
                    BorderBrush="{StaticResource PsyGradient}">
                <Border.CacheMode>
                    <BitmapCache RenderAtScale="1"/>
                </Border.CacheMode>
                <Border.Effect>
                    <DropShadowEffect Color="#B026FF" BlurRadius="8" ShadowDepth="0" Opacity="0.3"/>
                </Border.Effect>
                <views:VisualizerControl SpectrumData="{Binding SpectrumData}" 
                                         HorizontalAlignment="Stretch" 
                                         VerticalAlignment="Stretch"/>
            </Border>

            <!-- Playlist -->
            <Border Grid.Column="2"
                    Background="#0F0F1A"
                    CornerRadius="10"
                    BorderThickness="2"
                    BorderBrush="{StaticResource PsyGradient}">
                <Border.CacheMode>
                    <BitmapCache RenderAtScale="1"/>
                </Border.CacheMode>
                <Border.Effect>
                    <DropShadowEffect Color="#00BFFF" BlurRadius="8" ShadowDepth="0" Opacity="0.3"/>
                </Border.Effect>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <TextBlock Text="PLAYLIST"
                               FontSize="20"
                               FontWeight="Bold"
                               Margin="15,15,15,10"
                               Style="{StaticResource GlowTextPurple}"/>

                    <ListBox Grid.Row="1"
                             ItemsSource="{Binding Playlist}"
                             SelectedItem="{Binding CurrentTrack}"
                             Style="{StaticResource PsyListBox}"
                             BorderThickness="0"
                             Margin="10,0">
                        <ListBox.InputBindings>
                            <MouseBinding MouseAction="LeftDoubleClick"
                                        Command="{Binding PlayTrackCommand}"
                                        CommandParameter="{Binding SelectedItem, RelativeSource={RelativeSource AncestorType=ListBox}}"/>
                        </ListBox.InputBindings>
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <StackPanel Grid.Column="0">
                                        <TextBlock Text="{Binding Title}"
                                                   FontWeight="Bold"
                                                   FontSize="13"
                                                   Foreground="White"
                                                   TextTrimming="CharacterEllipsis"/>
                                        <TextBlock Text="{Binding Artist}"
                                                   FontSize="11"
                                                   Foreground="#B0B0B0"/>
                                    </StackPanel>
                                    <StackPanel Grid.Column="1" Orientation="Horizontal" Margin="10,0,0,0">
                                        <TextBlock Text="{Binding BPM}"
                                                   FontSize="12"
                                                   FontWeight="Bold"
                                                   Foreground="#FF1493"
                                                   VerticalAlignment="Center"
                                                   Margin="0,0,10,0"/>
                                        <TextBlock Text="{Binding Duration, Converter={StaticResource TimeConverter}}"
                                                   FontSize="12"
                                                   FontWeight="Bold"
                                                   Foreground="#00BFFF"
                                                   VerticalAlignment="Center"/>
                                    </StackPanel>
                                </Grid>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>

                    <Button Grid.Row="2"
                            Content="+ ADD FILES"
                            Style="{StaticResource PsyButton}"
                            Command="{Binding AddFilesCommand}"
                            Margin="10"/>
                </Grid>
            </Border>
        </Grid>

        <!-- Progress Bar -->
        <Border Grid.Row="2" Background="#1A1A2E" Padding="20,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0"
                           Text="{Binding CurrentPosition, Converter={StaticResource TimeConverter}}"
                           FontSize="14"
                           FontWeight="Bold"
                           Style="{StaticResource GlowText}"
                           VerticalAlignment="Center"
                           Margin="0,0,10,0"/>

                <Slider Grid.Column="1"
                        Minimum="0"
                        Maximum="{Binding TotalDuration.TotalSeconds}"
                        Value="{Binding CurrentPositionSeconds, Mode=TwoWay}"
                        Style="{StaticResource VolumeSlider}"
                        VerticalAlignment="Center"
                        ClipToBounds="False"
                        Height="45"/>

                <TextBlock Grid.Column="2"
                           Text="{Binding TotalDuration, Converter={StaticResource TimeConverter}}"
                           FontSize="14"
                           FontWeight="Bold"
                           Style="{StaticResource GlowText}"
                           VerticalAlignment="Center"
                           Margin="10,0,0,0"/>
            </Grid>
        </Border>

        <!-- Player Controls -->
        <Border Grid.Row="3" Background="#1A1A2E" Padding="20" ClipToBounds="False">
            <Grid ClipToBounds="False">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Volume Control -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center" ClipToBounds="False">
                    <TextBlock Text="VOLUME"
                               FontSize="14"
                               FontWeight="Bold"
                               Style="{StaticResource GlowTextGreen}"
                               VerticalAlignment="Center"
                               Margin="0,0,15,0"/>
                    <Slider Width="171"
                            Minimum="0"
                            Maximum="1"
                            Value="{Binding Volume}"
                            Style="{StaticResource VolumeSlider}"
                            VerticalAlignment="Center"
                            ClipToBounds="False" Height="45"/>
                </StackPanel>

                <!-- Play Controls -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center">
                    <Button Content="⏮"
                            Style="{StaticResource CircularButton}"
                            Command="{Binding PreviousCommand}"
                            FontSize="20"
                            Margin="5"/>

                    <Button Content="▶"
                            Style="{StaticResource CircularButton}"
                            Command="{Binding PlayCommand}"
                            FontSize="24"
                            Width="70"
                            Height="70"
                            Margin="10,0">
                        <Button.Visibility>
                            <Binding Path="IsPlaying">
                                <Binding.Converter>
                                    <converters:BoolToVisibilityConverter Inverted="True"/>
                                </Binding.Converter>
                            </Binding>
                        </Button.Visibility>
                    </Button>

                    <Button Content="⏸"
                            Style="{StaticResource CircularButton}"
                            Command="{Binding PauseCommand}"
                            FontSize="24"
                            Width="70"
                            Height="70"
                            Margin="10,0">
                        <Button.Visibility>
                            <Binding Path="IsPlaying">
                                <Binding.Converter>
                                    <converters:BoolToVisibilityConverter/>
                                </Binding.Converter>
                            </Binding>
                        </Button.Visibility>
                    </Button>

                    <Button Content="⏹"
                            Style="{StaticResource CircularButton}"
                            Command="{Binding StopCommand}"
                            FontSize="20"
                            Margin="5"/>

                    <Button Content="⏭"
                            Style="{StaticResource CircularButton}"
                            Command="{Binding NextCommand}"
                            FontSize="20"
                            Margin="5"/>
                </StackPanel>

                <Grid Grid.Column="2"/>
            </Grid>
        </Border>
    </Grid>
</Window>
