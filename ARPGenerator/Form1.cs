using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.IO;
using System.Linq;
using System.Windows.Forms;
using NAudio.Midi;
using BASSGenerator;
namespace MelodyGenerator
{
    public partial class Form1 : Form
    {
        private readonly Dictionary<string, Dictionary<string, int[]>> scalesByCategory;

        private readonly Dictionary<string, int> noteOffsets = new Dictionary<string, int>()
        {
            { "C", 0 }, { "C#", 1 }, { "Db", 1 }, { "D", 2 }, { "D#", 3 }, { "Eb", 3 },
            { "E", 4 }, { "F", 5 }, { "F#", 6 }, { "Gb", 6 }, { "G", 7 }, { "G#", 8 },
            { "Ab", 8 }, { "A", 9 }, { "A#", 10 }, { "Bb", 10 }, { "B", 11 },
        };

        // Словарь для хранения названий аккордов и их интервальной структуры
        private readonly Dictionary<string, int[]> chordTypes = new Dictionary<string, int[]>()
        {
            // Основные типы аккордов (трезвучия)
            { "Major", new int[] { 0, 4, 7 } },             // Мажорное трезвучие
            { "Minor", new int[] { 0, 3, 7 } },             // Минорное трезвучие
            { "Diminished", new int[] { 0, 3, 6 } },        // Уменьшенное трезвучие
            { "Augmented", new int[] { 0, 4, 8 } },         // Увеличенное трезвучие
            { "Sus2", new int[] { 0, 2, 7 } },              // Сус2
            { "Sus4", new int[] { 0, 5, 7 } },              // Сус4
            
            // Септаккорды
            { "Major7", new int[] { 0, 4, 7, 11 } },        // Большой мажорный септаккорд
            { "Minor7", new int[] { 0, 3, 7, 10 } },        // Малый минорный септаккорд
            { "Dominant7", new int[] { 0, 4, 7, 10 } },     // Доминантсептаккорд
            { "Diminished7", new int[] { 0, 3, 6, 9 } },    // Уменьшенный септаккорд
            { "Half-Diminished7", new int[] { 0, 3, 6, 10 }}, // Полууменьшенный септаккорд
            { "Minor-Major7", new int[] { 0, 3, 7, 11 } },   // Минорный-мажорный септаккорд
            { "Augmented7", new int[] { 0, 4, 8, 10 } },    // Увеличенный септаккорд
            
            // Аккорды с добавленными ступенями
            { "Add9", new int[] { 0, 4, 7, 14 } },          // Add9
            { "Add11", new int[] { 0, 4, 7, 17 } },         // Add11
            { "Add13", new int[] { 0, 4, 7, 21 } },         // Add13
            { "6", new int[] { 0, 4, 7, 9 } },             // Мажорный с секстой
            { "m6", new int[] { 0, 3, 7, 9 } },            // Минорный с секстой
            
            // Нонаккорды
            { "Major9", new int[] { 0, 4, 7, 11, 14 } },    // Большой мажорный нонаккорд
            { "Minor9", new int[] { 0, 3, 7, 10, 14 } },    // Малый минорный нонаккорд
            { "Dominant9", new int[] { 0, 4, 7, 10, 14 } }, // Доминантнонаккорд
            
            // Ундецимаккорды и терцдецимаккорды
            { "Major11", new int[] { 0, 4, 7, 11, 14, 17 } }, // Большой мажорный ундецимаккорд
            { "Minor11", new int[] { 0, 3, 7, 10, 14, 17 } }, // Малый минорный ундецимаккорд
            { "Dominant11", new int[] { 0, 4, 7, 10, 14, 17 } }, // Доминантундецимаккорд
            { "Major13", new int[] { 0, 4, 7, 11, 14, 17, 21 } }, // Большой мажорный терцдецимаккорд
            { "Minor13", new int[] { 0, 3, 7, 10, 14, 17, 21 } }, // Малый минорный терцдецимаккорд
            { "Dominant13", new int[] { 0, 4, 7, 10, 14, 17, 21 } }, // Доминанттерцдецимаккорд
            
            // Альтерированные аккорды
            { "7b5", new int[] { 0, 4, 6, 10 } },           // Доминантсептаккорд с пониженной квинтой
            { "7#5", new int[] { 0, 4, 8, 10 } },           // Доминантсептаккорд с повышенной квинтой
            { "7b9", new int[] { 0, 4, 7, 10, 13 } },       // Доминантсептаккорд с пониженной ноной
            { "7#9", new int[] { 0, 4, 7, 10, 15 } },       // Доминантсептаккорд с повышенной ноной
            { "7#11", new int[] { 0, 4, 7, 10, 14, 18 } },  // Доминантсептаккорд с повышенной ундецимой
            { "7b13", new int[] { 0, 4, 7, 10, 14, 17, 20 } }, // Доминантсептаккорд с пониженной терцдецимой
            
            // Специальные аккорды
            { "5", new int[] { 0, 7 } },                   // Квинтаккорд (пауэр-аккорд)
            { "Quartal", new int[] { 0, 5, 10 } },          // Квартовый аккорд
            { "Polychord C/G", new int[] { 0, 4, 7, 12, 19 } }, // Полиаккорд C/G
            
            // Экзотические аккорды
            { "Phrygian", new int[] { 0, 3, 7, 10, 13 } },   // Фригийский аккорд
            { "Lydian", new int[] { 0, 4, 7, 11, 18 } },     // Лидийский аккорд
            { "Hendrix", new int[] { 0, 4, 7, 10, 15 } },    // "Hendrix chord" (7#9)
            { "So What", new int[] { 0, 5, 10, 17, 22 } },   // "So What" chord (Miles Davis)
        };

        private string lastGeneratedMidiPath = string.Empty;
        private readonly Random random = new Random();
        // Добавьте это поле в класс Form1

        public Form1()
        {
            scalesByCategory = InitializeScalesByCategory();
            InitializeComponent();
            InitializeTonicaComboBox();
            InitializeCategoryComboBox();
            InitializeScaleComboBox();
            InitializePlayButton();
            SetupNoteDisplayControl();
            // Привязываем событие изменения категории
            cmbBoxCategory.SelectedIndexChanged += CmbBoxCategory_SelectedIndexChanged;
        }

        private static Dictionary<string, Dictionary<string, int[]>> InitializeScalesByCategory()
        {
            var result = new Dictionary<string, Dictionary<string, int[]>>();

            // Упрощенный словарь для примера - замените на свой полный словарь BigScalePatterns
            var bigScalePatterns = new Dictionary<string, Dictionary<string, List<int>>>
{
    // Категория: Классические/Западные
    {
        "Классические/Западные", new Dictionary<string, List<int>>
        {
            {"Мажор (Ionian)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Натуральный минор (Aeolian)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Гармонический минор", new List<int> {2, 1, 2, 2, 1, 3, 1}},
            {"Мелодический минор (Asc.)", new List<int> {2, 1, 2, 2, 2, 2, 1}},
            {"Дорийский (Dorian)", new List<int> {2, 1, 2, 2, 2, 1, 2}},
            {"Фригийский (Phrygian)", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Лидийский (Lydian)", new List<int> {2, 2, 2, 1, 2, 2, 1}},
            {"Миксолидийский (Mixolyd.)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Локрийский (Locrian)", new List<int> {1, 2, 2, 1, 2, 2, 2}},
            {"Неаполитанский мажор", new List<int> {1, 2, 2, 2, 2, 2, 1}},
            {"Неаполитанский минор", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Целотонный (Whole Tone)", new List<int> {2, 2, 2, 2, 2, 2}},
            {"Хроматический (12 Half)", new List<int> {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1}},
            {"Лидийский доминантный (Lydian Dominant)", new List<int> {2, 2, 2, 1, 2, 1, 2}},
            {"Фригийский доминантный (Phrygian Dominant)", new List<int> {1, 3, 1, 2, 1, 2, 2}},
            {"Миксолидийский ♭6", new List<int> {2, 2, 1, 2, 1, 2, 2}},
            {"Локрийский ♮2", new List<int> {2, 1, 2, 1, 2, 2, 2}},
            {"Аугментированный (Augmented)", new List<int> {3, 1, 3, 1, 3, 1}},
            {"Эолийский ♭5 (Aeolian ♭5)", new List<int> {2, 1, 2, 1, 2, 2, 2}},
            {"Дорийский ♯4", new List<int> {2, 1, 3, 1, 2, 1, 2}},
            {"Сверхлокрийский (Super Locrian)", new List<int> {1, 2, 1, 2, 2, 2, 2}},
            {"Миксолидийский ♭2", new List<int> {1, 3, 1, 2, 2, 1, 2}},
            {"Дорийский ♭5", new List<int> {2, 1, 2, 1, 2, 2, 2}},
            {"Лидийский ♯2", new List<int> {3, 1, 2, 1, 2, 2, 1}},
            {"Фригийский ♯6", new List<int> {1, 2, 2, 2, 2, 1, 2}},
            {"Миксолидийский ♯11", new List<int> {2, 2, 2, 1, 2, 1, 2}},
            {"Локрийский ♭4", new List<int> {1, 2, 1, 2, 2, 2, 2}},
            {"Гармонический мажор", new List<int> {2, 2, 1, 2, 1, 3, 1}},
            {"Мелодический мажор", new List<int> {2, 2, 1, 2, 1, 2, 2}},
            {"Эолийский ♯7", new List<int> {2, 1, 2, 2, 1, 3, 1}},
            {"Дорийский ♯2", new List<int> {3, 1, 2, 2, 1, 2, 1}},
            {"Лидийский ♭3", new List<int> {2, 1, 3, 1, 2, 2, 1}},
            {"Фригийский ♯3", new List<int> {1, 3, 1, 2, 1, 2, 2}},
            {"Миксолидийский ♭13", new List<int> {2, 2, 1, 2, 1, 2, 2}},
            {"Локрийский ♮6", new List<int> {1, 2, 2, 1, 3, 1, 2}},
            {"Ионийский ♯5", new List<int> {2, 2, 2, 1, 2, 2, 1}},
            {"Эолийский ♭1", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Ионийский ♭6", new List<int> {2, 2, 1, 2, 1, 2, 2}},
            {"Дорийский ♭13", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Фригийский ♭7", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Лидийский ♯5", new List<int> {2, 2, 2, 2, 1, 2, 1}},
            {"Миксолидийский ♯9", new List<int> {3, 1, 1, 2, 2, 1, 2}},
            {"Локрийский ♯7", new List<int> {1, 2, 2, 1, 2, 3, 1}},
            {"Эолийский ♯3", new List<int> {2, 2, 1, 2, 1, 2, 2}},
            {"Дорийский ♭3", new List<int> {2, 1, 1, 3, 2, 1, 2}},
            {"Фригийский ♯2", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Лидийский ♭9", new List<int> {1, 3, 2, 1, 2, 2, 1}},
            {"Миксолидийский ♭5", new List<int> {2, 2, 1, 1, 2, 2, 2}},
            {"Локрийский ♮3", new List<int> {1, 3, 1, 1, 2, 2, 2}},
            {"Ионийский ♭2", new List<int> {1, 3, 1, 2, 2, 2, 1}},
            {"Эолийский ♯6", new List<int> {2, 1, 2, 2, 2, 1, 2}},
            {"Дорийский ♯7", new List<int> {2, 1, 2, 2, 1, 3, 1}},
            {"Фригийский ♭5", new List<int> {1, 2, 2, 1, 2, 2, 2}},
            {"Лидийский ♯11", new List<int> {2, 2, 2, 1, 2, 1, 2}},
            {"Миксолидийский ♯2", new List<int> {3, 1, 1, 2, 2, 1, 2}},
            {"Локрийский ♭6", new List<int> {1, 2, 2, 1, 2, 1, 3}},
            {"Ионийский ♭3", new List<int> {2, 1, 2, 2, 2, 2, 1}},
            {"Эолийский ♭9", new List<int> {1, 3, 2, 2, 1, 2, 2}},
            {"Дорийский ♭4", new List<int> {2, 1, 1, 3, 2, 1, 2}},
            {"Фригийский ♯9", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Лидийский ♭13", new List<int> {2, 2, 2, 1, 1, 2, 2}},
            {"Миксолидийский ♭7", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Локрийский ♯5", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Ионийский ♯9", new List<int> {3, 1, 1, 2, 2, 2, 1}},
            {"Эолийский ♭2", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Дорийский ♯6", new List<int> {2, 1, 2, 2, 2, 1, 2}},
            {"Фригийский ♭3", new List<int> {1, 2, 1, 3, 1, 2, 2}},
            {"Лидийский ♯3", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Миксолидийский ♯4", new List<int> {2, 2, 2, 1, 2, 1, 2}},
            {"Локрийский ♮9", new List<int> {2, 1, 2, 1, 2, 2, 2}},
            {"Ионийский ♭5", new List<int> {2, 2, 1, 1, 2, 2, 2}},
            {"Эолийский ♯4", new List<int> {2, 1, 3, 1, 2, 2, 1}},
            {"Дорийский ♭6", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Фригийский ♯4", new List<int> {1, 2, 3, 1, 1, 2, 2}},
            {"Лидийский ♭2", new List<int> {1, 3, 2, 1, 2, 2, 1}},
            {"Миксолидийский ♭9", new List<int> {1, 3, 1, 2, 2, 1, 2}},
            {"Локрийский ♭3", new List<int> {1, 2, 1, 2, 2, 2, 2}},
            {"Ионийский ♯6", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Эолийский ♭7", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Дорийский ♯9", new List<int> {3, 1, 1, 2, 2, 1, 2}},
            {"Фригийский ♭6", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Лидийский ♯7", new List<int> {2, 2, 2, 1, 2, 2, 1}},
            {"Миксолидийский ♭4", new List<int> {2, 2, 1, 1, 3, 1, 2}},
            {"Локрийский ♮4", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Ионийский ♭9", new List<int> {1, 3, 1, 2, 2, 2, 1}},
            {"Эолийский ♯5", new List<int> {2, 1, 2, 2, 2, 2, 1}},
            {"Дорийский ♭7", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Фригийский ♯5", new List<int> {1, 2, 2, 2, 2, 1, 2}},
            {"Лидийский ♭4", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Миксолидийский ♯6", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Локрийский ♭9", new List<int> {1, 3, 1, 1, 2, 2, 2}},
            {"Ионийский ♯2", new List<int> {3, 1, 1, 2, 2, 2, 1}},
            {"Эолийский ♭3", new List<int> {2, 1, 1, 3, 1, 2, 2}},
            {"Дорийский ♯5", new List<int> {2, 1, 2, 2, 2, 1, 2}},
            {"Фригийский ♭9", new List<int> {1, 3, 1, 2, 1, 2, 2}},
            {"Лидийский ♯6", new List<int> {2, 2, 2, 1, 2, 1, 2}},
            {"Миксолидийский ♭3", new List<int> {2, 1, 2, 2, 2, 1, 2}},
            {"Локрийский ♮7", new List<int> {1, 2, 2, 1, 2, 2, 2}},
            {"Ионийский ♭7", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Эолийский ♯9", new List<int> {3, 1, 2, 2, 1, 2, 2}},
            {"Дорийский ♭2", new List<int> {1, 3, 1, 2, 2, 1, 2}},
            {"Фригийский ♯7", new List<int> {1, 2, 2, 2, 1, 3, 1}},
            {"Лидийский ♭5", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Миксолидийский ♯5", new List<int> {2, 2, 2, 1, 2, 1, 2}},
            {"Локрийский ♭2", new List<int> {1, 1, 3, 1, 2, 2, 2}},
            {"Ионийский ♯3", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Эолийский ♭6", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            // Новые лады (70)
            {"Ионийский ♭13", new List<int> {2, 2, 1, 2, 1, 2, 2}},
            {"Дорийский ♯13", new List<int> {2, 1, 2, 2, 2, 1, 2}},
            {"Фригийский ♭13", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Лидийский ♯13", new List<int> {2, 2, 2, 1, 2, 1, 2}},
            {"Миксолидийский ♭11", new List<int> {2, 2, 1, 1, 3, 1, 2}},
            {"Локрийский ♯11", new List<int> {1, 2, 3, 1, 1, 2, 2}},
            {"Эолийский ♭4", new List<int> {2, 1, 1, 3, 1, 2, 2}},
            {"Дорийский ♭11", new List<int> {2, 1, 1, 3, 2, 1, 2}},
            {"Фригийский ♯11", new List<int> {1, 2, 3, 1, 1, 2, 2}},
            {"Лидийский ♭11", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Миксолидийский ♯13", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Локрийский ♭5", new List<int> {1, 2, 1, 2, 2, 2, 2}},
            {"Ионийский ♯11", new List<int> {2, 2, 2, 1, 2, 2, 1}},
            {"Эолийский ♯11", new List<int> {2, 1, 3, 1, 1, 2, 2}},
            {"Дорийский ♭9", new List<int> {1, 3, 1, 2, 2, 1, 2}},
            {"Фригийский ♭4", new List<int> {1, 2, 1, 3, 1, 2, 2}},
            {"Лидийский ♯9", new List<int> {3, 1, 2, 1, 2, 2, 1}},
            {"Локрийский ♮5", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Ионийский ♭4", new List<int> {2, 2, 1, 1, 3, 2, 1}},
            {"Эолийский ♭13", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Дорийский ♯3", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Фригийский ♯13", new List<int> {1, 2, 2, 2, 2, 1, 2}},
            {"Лидийский ♭7", new List<int> {2, 2, 2, 1, 2, 1, 2}},
            {"Миксолидийский ♯7", new List<int> {2, 2, 1, 2, 1, 3, 1}},
            {"Локрийский ♭11", new List<int> {1, 2, 1, 2, 2, 2, 2}},
            {"Ионийский ♯13", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Эолийский ♯2", new List<int> {3, 1, 2, 2, 1, 2, 2}},
            {"Дорийский ♭10", new List<int> {2, 1, 2, 1, 2, 2, 2}},
            {"Фригийский ♭10", new List<int> {1, 2, 2, 1, 2, 2, 2}},
            {"Лидийский ♯10", new List<int> {2, 2, 2, 1, 2, 2, 1}},
            {"Миксолидийский ♭10", new List<int> {2, 2, 1, 1, 2, 2, 2}},
            {"Локрийский ♮10", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Ионийский ♭10", new List<int> {2, 2, 1, 1, 2, 2, 2}},
            {"Эолийский ♯10", new List<int> {2, 1, 3, 1, 2, 2, 1}},
            {"Дорийский ♭8", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Фригийский ♯8", new List<int> {1, 2, 2, 2, 1, 3, 1}},
            {"Лидийский ♭8", new List<int> {2, 2, 2, 1, 2, 1, 2}},
            {"Миксолидийский ♯8", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Локрийский ♮8", new List<int> {1, 2, 2, 1, 2, 2, 2}},
            {"Ионийский ♭8", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Эолийский ♯8", new List<int> {2, 1, 2, 2, 1, 3, 1}},
            {"Дорийский ♭12", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Фригийский ♯12", new List<int> {1, 2, 2, 2, 1, 3, 1}},
            {"Лидийский ♭12", new List<int> {2, 2, 2, 1, 2, 1, 2}},
            {"Миксолидийский ♯12", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Локрийский ♮12", new List<int> {1, 2, 2, 1, 2, 2, 2}},
            {"Ионийский ♭12", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Эолийский ♯12", new List<int> {2, 1, 2, 2, 1, 3, 1}},
            {"Дорийский ♭14", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Фригийский ♯14", new List<int> {1, 2, 2, 2, 1, 3, 1}},
            {"Лидийский ♭14", new List<int> {2, 2, 2, 1, 2, 1, 2}},
            {"Миксолидийский ♯14", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Локрийский ♮14", new List<int> {1, 2, 2, 1, 2, 2, 2}},
            {"Ионийский ♭14", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Эолийский ♯14", new List<int> {2, 1, 2, 2, 1, 3, 1}},
            {"Дорийский ♭15", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Фригийский ♯15", new List<int> {1, 2, 2, 2, 1, 3, 1}},
            {"Лидийский ♭15", new List<int> {2, 2, 2, 1, 2, 1, 2}},
            {"Миксолидийский ♯15", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Локрийский ♮15", new List<int> {1, 2, 2, 1, 2, 2, 2}},
            {"Ионийский ♭15", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Эолийский ♯15", new List<int> {2, 1, 2, 2, 1, 3, 1}}
        }
    },
    // Категория: Джазовые
    {
        "Джазовые", new Dictionary<string, List<int>>
        {
            {"Мажорный бибоп", new List<int> {2, 2, 1, 2, 2, 1, 1, 2}},
            {"Минорный бибоп", new List<int> {2, 1, 2, 2, 1, 1, 2, 2}},
            {"Доминиантный бибоп", new List<int> {2, 2, 1, 2, 1, 1, 2, 2}},
            {"Джаз-фанк (Jazz Funk)", new List<int> {2, 2, 1, 2, 1, 1, 2}},
            {"Афро-джаз (Afro-Jazz)", new List<int> {2, 2, 1, 2, 1, 2, 2}},
            {"Джазовая целотонная (Jazz Whole Tone)", new List<int> {2, 2, 2, 2, 1, 3}},
            {"Лидийский ♭7 (Lydian ♭7)", new List<int> {2, 2, 2, 1, 2, 1, 2}},
            {"Миксолидийский ♭9", new List<int> {1, 3, 1, 2, 2, 1, 2}},
            {"Дорийский ♭2", new List<int> {1, 2, 2, 2, 2, 1, 2}},
            {"Хроматический бибоп (Chromatic Bebop)", new List<int> {2, 1, 1, 2, 2, 1, 1, 2}},
            {"Фригийский ♭4", new List<int> {1, 2, 1, 3, 1, 2, 2}},
            {"Лидийский увеличенный (Lydian Augmented)", new List<int> {2, 2, 2, 2, 1, 2, 1}},
            {"Полутон-целотон (Half-Whole)", new List<int> {1, 2, 1, 2, 1, 2, 1, 2}},
            {"Целотон-полутон (Whole-Half)", new List<int> {2, 1, 2, 1, 2, 1, 2, 1}},
            {"Дорийский ♭9", new List<int> {1, 3, 1, 2, 2, 1, 2}},
            {"Лидийский ♯9", new List<int> {3, 1, 2, 1, 2, 2, 1}},
            {"Миксолидийский ♯5", new List<int> {2, 2, 2, 1, 2, 1, 2}},
            {"Фригийский ♯7", new List<int> {1, 2, 2, 2, 1, 3, 1}},
            {"Локрийский ♭13", new List<int> {1, 2, 2, 1, 2, 1, 3}},
            {"Бибоп мажор ♭6", new List<int> {2, 2, 1, 2, 1, 1, 2, 2}},
            {"Бибоп минор ♯4", new List<int> {2, 1, 3, 1, 1, 1, 2, 2}},
            {"Дорийский ♯11", new List<int> {2, 1, 3, 1, 2, 1, 2}},
            {"Лидийский ♭6", new List<int> {2, 2, 2, 1, 1, 2, 2}},
            {"Миксолидийский ♭3", new List<int> {2, 1, 2, 2, 2, 1, 2}},
            {"Фригийский ♭2", new List<int> {1, 1, 3, 2, 1, 2, 2}},
            {"Локрийский ♯3", new List<int> {1, 3, 1, 1, 2, 2, 2}},
            {"Джазовый симметричный", new List<int> {1, 3, 1, 3, 1, 3}},
            {"Целотонный ♭5", new List<int> {2, 2, 1, 2, 2, 3}},
            {"Бибоп доминант ♯9", new List<int> {3, 1, 1, 2, 1, 1, 2, 2}},
            {"Дорийский ♯5", new List<int> {2, 1, 2, 2, 2, 1, 2}},
            {"Лидийский ♯2", new List<int> {3, 1, 2, 1, 2, 2, 1}},
            {"Миксолидийский ♭13", new List<int> {2, 2, 1, 2, 1, 2, 2}},
            {"Фригийский ♯6", new List<int> {1, 2, 2, 2, 2, 1, 2}},
            {"Локрийский ♮2", new List<int> {2, 1, 2, 1, 2, 2, 2}},
            {"Бибоп мажор ♯5", new List<int> {2, 2, 2, 1, 1, 1, 2, 2}},
            {"Бибоп минор ♭9", new List<int> {1, 3, 1, 2, 1, 1, 2, 2}},
            {"Дорийский ♭4", new List<int> {2, 1, 1, 3, 2, 1, 2}},
            {"Лидийский ♭3", new List<int> {2, 1, 3, 1, 2, 2, 1}},
            {"Миксолидийский ♯11", new List<int> {2, 2, 2, 1, 2, 1, 2}},
            {"Фригийский ♭5", new List<int> {1, 2, 2, 1, 2, 2, 2}},
            {"Локрийский ♯4", new List<int> {1, 2, 3, 1, 1, 2, 2}},
            {"Джазовый ♭6", new List<int> {2, 2, 1, 2, 1, 2, 2}},
            {"Целотонный ♯5", new List<int> {2, 2, 2, 1, 2, 2, 1}},
            {"Бибоп доминант ♭13", new List<int> {2, 2, 1, 2, 1, 1, 2, 2}},
            {"Дорийский ♭7", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Лидийский ♯6", new List<int> {2, 2, 2, 1, 2, 1, 2}},
            {"Миксолидийский ♭2", new List<int> {1, 3, 1, 2, 2, 1, 2}},
            {"Фригийский ♯9", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Локрийский ♮6", new List<int> {1, 2, 2, 1, 3, 1, 2}},
            {"Бибоп мажор ♭9", new List<int> {1, 3, 1, 2, 2, 1, 1, 2}},
            {"Бибоп минор ♯7", new List<int> {2, 1, 2, 2, 1, 1, 3, 1}},
            {"Дорийский ♯3", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Лидийский ♭4", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Миксолидийский ♯4", new List<int> {2, 2, 2, 1, 2, 1, 2}},
            {"Фригийский ♭3", new List<int> {1, 2, 1, 3, 1, 2, 2}},
            {"Локрийский ♯5", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Джазовый ♭2", new List<int> {1, 3, 1, 2, 2, 1, 2}},
            {"Целотонный ♭3", new List<int> {2, 1, 2, 2, 2, 3}},
            {"Бибоп доминант ♯5", new List<int> {2, 2, 2, 1, 1, 1, 2, 2}},
            {"Дорийский ♭6", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Лидийский ♯3", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Миксолидийский ♭7", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Фригийский ♯2", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Локрийский ♮9", new List<int> {2, 1, 2, 1, 2, 2, 2}},
            {"Бибоп мажор ♯9", new List<int> {3, 1, 1, 2, 2, 1, 1, 2}},
            {"Бибоп минор ♭13", new List<int> {2, 1, 2, 2, 1, 1, 2, 2}},
            {"Дорийский ♯6", new List<int> {2, 1, 2, 2, 2, 1, 2}},
            {"Лидийский ♭9", new List<int> {1, 3, 2, 1, 2, 2, 1}},
            {"Миксолидийский ♯6", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Фригийский ♭6", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Локрийский ♮4", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Джазовый ♭3", new List<int> {2, 1, 2, 2, 2, 1, 2}},
            {"Целотонный ♯2", new List<int> {3, 1, 2, 2, 2, 2}},
            {"Бибоп доминант ♭9", new List<int> {1, 3, 1, 2, 1, 1, 2, 2}},
            {"Дорийский ♭3", new List<int> {2, 1, 1, 3, 2, 1, 2}},
            {"Лидийский ♯4", new List<int> {2, 2, 2, 1, 2, 1, 2}},
            {"Миксолидийский ♭4", new List<int> {2, 2, 1, 1, 3, 1, 2}},
            {"Фригийский ♯3", new List<int> {1, 3, 1, 2, 1, 2, 2}},
            {"Локрийский ♭7", new List<int> {1, 2, 2, 1, 2, 2, 2}},
            {"Джазовый ♯5", new List<int> {2, 2, 2, 1, 2, 1, 2}},
            {"Целотонный ♭6", new List<int> {2, 2, 2, 1, 2, 2, 1}},
            {"Бибоп мажор ♭2", new List<int> {1, 3, 1, 2, 2, 1, 1, 2}},
            {"Бибоп минор ♯6", new List<int> {2, 1, 2, 2, 2, 1, 1, 2}},
            {"Дорийский ♯9", new List<int> {3, 1, 1, 2, 2, 1, 2}},
            {"Лидийский ♭2", new List<int> {1, 3, 2, 1, 2, 2, 1}},
            {"Миксолидийский ♯9", new List<int> {3, 1, 1, 2, 2, 1, 2}},
            {"Фригийский ♭9", new List<int> {1, 3, 1, 2, 1, 2, 2}},
            {"Локрийский ♮5", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Джазовый ♭9", new List<int> {1, 3, 1, 2, 2, 1, 2}},
            {"Целотонный ♯3", new List<int> {2, 2, 1, 2, 2, 3}},
            {"Бибоп доминант ♯2", new List<int> {3, 1, 1, 2, 1, 1, 2, 2}},
            {"Дорийский ♭5", new List<int> {2, 1, 2, 1, 2, 2, 2}},
            {"Лидийский ♯7", new List<int> {2, 2, 2, 1, 2, 2, 1}},
            {"Фригийский ♯4", new List<int> {1, 2, 3, 1, 1, 2, 2}},
            {"Локрийский ♭2", new List<int> {1, 1, 3, 1, 2, 2, 2}},
            {"Джазовый ♯2", new List<int> {3, 1, 1, 2, 2, 1, 2}},
            {"Целотонный ♭7", new List<int> {2, 2, 2, 1, 2, 2, 1}},
            // Новые лады (70)
            {"Джазовый ♭13", new List<int> {2, 2, 1, 2, 1, 2, 2}},
            {"Бибоп мажор ♭13", new List<int> {2, 2, 1, 2, 1, 1, 2, 2}},
            {"Бибоп минор ♯9", new List<int> {3, 1, 1, 2, 1, 1, 2, 2}},
            {"Дорийский ♭11", new List<int> {2, 1, 1, 3, 2, 1, 2}},
            {"Лидийский ♯11", new List<int> {2, 2, 2, 1, 2, 1, 2}},
            {"Миксолидийский ♭11", new List<int> {2, 2, 1, 1, 3, 1, 2}},
            {"Фригийский ♯11", new List<int> {1, 2, 3, 1, 1, 2, 2}},
            {"Локрийский ♭4", new List<int> {1, 2, 1, 2, 2, 2, 2}},
            {"Джазовый ♯6", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Целотонный ♯9", new List<int> {3, 1, 2, 2, 2, 2}},
            {"Бибоп доминант ♭6", new List<int> {2, 2, 1, 2, 1, 1, 2, 2}},
            {"Дорийский ♯13", new List<int> {2, 1, 2, 2, 2, 1, 2}},
            {"Лидийский ♭13", new List<int> {2, 2, 2, 1, 1, 2, 2}},
            {"Миксолидийский ♯13", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Фригийский ♭13", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Локрийский ♯6", new List<int> {1, 2, 2, 1, 3, 1, 2}},
            {"Джазовый ♭4", new List<int> {2, 2, 1, 1, 3, 2, 1}},
            {"Целотонный ♭2", new List<int> {1, 3, 2, 2, 2, 2}},
            {"Бибоп мажор ♯11", new List<int> {2, 2, 2, 1, 1, 1, 2, 2}},
            {"Бибоп минор ♭2", new List<int> {1, 3, 1, 2, 1, 1, 2, 2}},
            {"Дорийский ♭8", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Лидийский ♯8", new List<int> {2, 2, 2, 1, 2, 1, 2}},
            {"Миксолидийский ♭8", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Фригийский ♯8", new List<int> {1, 2, 2, 2, 1, 3, 1}},
            {"Локрийский ♮8", new List<int> {1, 2, 2, 1, 2, 2, 2}},
            {"Джазовый ♯9", new List<int> {3, 1, 1, 2, 2, 1, 2}},
            {"Целотонный ♭13", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Бибоп доминант ♯11", new List<int> {2, 2, 2, 1, 1, 1, 2, 2}},
            {"Дорийский ♯4", new List<int> {2, 1, 3, 1, 2, 1, 2}},
            {"Лидийский ♭5", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Миксолидийский ♯2", new List<int> {3, 1, 1, 2, 2, 1, 2}},
            {"Фригийский ♭7", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Локрийский ♯7", new List<int> {1, 2, 2, 1, 2, 3, 1}},
            {"Джазовый ♭5", new List<int> {2, 2, 1, 1, 2, 2, 2}},
            {"Целотонный ♯6", new List<int> {2, 2, 2, 1, 2, 2, 1}},
            {"Бибоп мажор ♭3", new List<int> {2, 1, 2, 2, 2, 1, 1, 2}},
            {"Бибоп минор ♯3", new List<int> {2, 2, 1, 2, 1, 1, 2, 2}},
            {"Дорийский ♭12", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Лидийский ♯12", new List<int> {2, 2, 2, 1, 2, 1, 2}},
            {"Миксолидийский ♭12", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Фригийский ♯12", new List<int> {1, 2, 2, 2, 1, 3, 1}},
            {"Локрийский ♮12", new List<int> {1, 2, 2, 1, 2, 2, 2}},
            {"Джазовый ♯11", new List<int> {2, 2, 2, 1, 2, 1, 2}},
            {"Целотонный ♭9", new List<int> {1, 3, 2, 2, 2, 2}},
            {"Бибоп доминант ♭2", new List<int> {1, 3, 1, 2, 1, 1, 2, 2}},
            {"Дорийский ♯10", new List<int> {2, 1, 2, 2, 2, 1, 2}},
            {"Лидийский ♭10", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Миксолидийский ♯10", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Фригийский ♭10", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Локрийский ♮10", new List<int> {1, 2, 2, 1, 2, 2, 2}},
            {"Джазовый ♭11", new List<int> {2, 2, 1, 1, 3, 1, 2}},
            {"Целотонный ♯11", new List<int> {2, 2, 2, 1, 2, 2, 1}},
            {"Бибоп мажор ♭4", new List<int> {2, 2, 1, 1, 2, 1, 2, 2}},
            {"Бибоп минор ♯5", new List<int> {2, 1, 2, 2, 2, 1, 1, 2}},
            {"Дорийский ♭14", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Лидийский ♯14", new List<int> {2, 2, 2, 1, 2, 1, 2}},
            {"Миксолидийский ♭14", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Фригийский ♯14", new List<int> {1, 2, 2, 2, 1, 3, 1}},
            {"Локрийский ♮14", new List<int> {1, 2, 2, 1, 2, 2, 2}},
            {"Джазовый ♭7", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Целотонный ♯13", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Бибоп доминант ♭3", new List<int> {2, 1, 2, 2, 1, 1, 2, 2}}
        }
    },
    // Категория: Пентатоники/Блюз
    {
        "Пентатоники/Блюз", new Dictionary<string, List<int>>
        {
            {"Мажорная пентатоника", new List<int> {2, 2, 3, 2, 3}},
            {"Минорная пентатоника", new List<int> {3, 2, 2, 3, 2}},
            {"Блюзовая (Blues)", new List<int> {3, 2, 1, 1, 3, 2}},
            {"Египетская (Egyptian)", new List<int> {2, 1, 2, 2, 2, 2, 3}},
            {"Японская (Hirajoshi)", new List<int> {2, 1, 4, 1, 4}},
            {"Японская (Iwato)", new List<int> {1, 4, 1, 4, 2}},
            {"Китайская (Mongolian)", new List<int> {2, 2, 3, 2, 3}},
            {"Вьетнамская (Vietnamese)", new List<int> {2, 3, 2, 2, 3}},
            {"Тибетская (Tibetan)", new List<int> {2, 2, 3, 2, 3}},
            {"Малайская (Pelog)", new List<int> {1, 2, 4, 1, 4}},
            {"Индийская (Malkauns)", new List<int> {3, 2, 2, 3, 2}},
            {"Индийская (Bhoopali)", new List<int> {2, 2, 1, 2, 3}},
            {"Индийская (Shivranjani)", new List<int> {2, 1, 2, 3, 4}},
            {"Японская (Kumoi)", new List<int> {2, 1, 4, 2, 3}},
            {"Индийская (Hamsadhwani)", new List<int> {2, 2, 2, 3, 3}},
            {"Блюзовая мажорная (Major Blues)", new List<int> {2, 1, 1, 2, 3, 3}},
            {"Пентатоника доминантная (Dominant Pentatonic)", new List<int> {2, 2, 3, 2, 3}},
            {"Кельтская пентатоника (Celtic Pentatonic)", new List<int> {2, 3, 2, 3, 2}},
            {"Балийская (Balinese)", new List<int> {1, 2, 4, 1, 4}},
            {"Индийская (Khamaj)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Японская (Nohkan)", new List<int> {2, 3, 2, 1, 4}},
            {"Африканская (Zezuru)", new List<int> {3, 2, 2, 2, 3}},
            {"Индийская (Mand)", new List<int> {2, 2, 1, 2, 3}},
            {"Японская (Ritsu)", new List<int> {2, 2, 3, 1, 4}},
            {"Китайская (Yu)", new List<int> {2, 3, 2, 2, 3}},
            {"Тайская (Sawasdee)", new List<int> {2, 1, 3, 2, 4}},
            {"Африканская (Nguni)", new List<int> {3, 2, 1, 3, 3}},
            {"Индийская (Basant)", new List<int> {2, 2, 2, 1, 3}},
            {"Японская (Miyako)", new List<int> {1, 4, 1, 3, 3}},
            {"Кельтская (Breton)", new List<int> {2, 1, 3, 3, 3}},
            {"Блюзовая ♯5", new List<int> {3, 2, 2, 1, 3, 1}},
            {"Пентатоника ♭9", new List<int> {1, 3, 2, 3, 3}},
            {"Индийская (Bilaval)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Японская (Yo)", new List<int> {2, 2, 3, 2, 3}},
            {"Китайская (Pi)", new List<int> {3, 2, 2, 2, 3}},
            {"Тайская (Phaung)", new List<int> {2, 1, 3, 2, 4}},
            {"Африканская (Baka)", new List<int> {2, 2, 2, 3, 3}},
            {"Индийская (Megh)", new List<int> {2, 1, 2, 3, 4}},
            {"Японская (In)", new List<int> {1, 4, 1, 4, 2}},
            {"Кельтская (Galician)", new List<int> {2, 1, 3, 2, 4}},
            {"Блюзовая ♭13", new List<int> {3, 2, 1, 1, 2, 2, 2}},
            {"Пентатоника ♯2", new List<int> {3, 1, 2, 3, 3}},
            {"Индийская (Sarang)", new List<int> {2, 2, 1, 2, 3}},
            {"Японская (Shinobue)", new List<int> {2, 1, 4, 1, 4}},
            {"Китайская (Qing)", new List<int> {2, 3, 2, 1, 4}},
            {"Тайская (Lanna)", new List<int> {2, 2, 2, 1, 3}},
            {"Африканская (Shona)", new List<int> {3, 2, 2, 1, 4}},
            {"Индийская (Malhar)", new List<int> {2, 1, 2, 2, 3}},
            {"Японская (Koto)", new List<int> {1, 4, 2, 1, 4}},
            {"Кельтская (Welsh)", new List<int> {2, 1, 2, 2, 3}},
            {"Блюзовая ♯9", new List<int> {3, 1, 1, 1, 3, 2}},
            {"Пентатоника ♭3", new List<int> {2, 1, 3, 3, 3}},
            {"Индийская (Gaud)", new List<int> {2, 2, 2, 1, 3}},
            {"Японская (Shakuhachi)", new List<int> {2, 3, 1, 4, 2}},
            {"Китайская (Xun)", new List<int> {2, 2, 3, 2, 3}},
            {"Тайская (Isan)", new List<int> {2, 1, 3, 2, 4}},
            {"Африканская (Tswana)", new List<int> {3, 2, 1, 3, 3}},
            {"Индийская (Tilang)", new List<int> {2, 2, 1, 2, 3}},
            {"Японская (Hichiriki)", new List<int> {1, 4, 1, 3, 3}},
            {"Кельтская (Cornish)", new List<int> {2, 1, 3, 2, 4}},
            {"Пентатоника ♯5", new List<int> {2, 2, 2, 3, 2}},
            {"Индийская (Ahir)", new List<int> {2, 1, 3, 2, 3}},
            {"Японская (Gagaku)", new List<int> {2, 2, 3, 1, 4}},
            {"Китайская (Zheng)", new List<int> {2, 3, 2, 2, 3}},
            {"Тайская (Morlam)", new List<int> {2, 1, 3, 2, 4}},
            {"Африканская (Xhosa)", new List<int> {3, 2, 1, 3, 3}},
            {"Индийская (Sohini)", new List<int> {2, 2, 2, 1, 3}},
            {"Японская (Ryukyu)", new List<int> {1, 4, 1, 3, 3}},
            {"Кельтская (Manx)", new List<int> {2, 1, 3, 2, 4}},
            {"Блюзовая ♯2", new List<int> {3, 1, 1, 1, 3, 2}},
            {"Пентатоника ♭6", new List<int> {2, 2, 2, 1, 3}},
            {"Индийская (Vachaspati)", new List<int> {2, 2, 2, 1, 2, 1, 2}},
            {"Японская (Sanshin)", new List<int> {2, 1, 4, 1, 4}},
            {"Китайская (Pipa)", new List<int> {2, 3, 2, 1, 4}},
            {"Тайская (Khene)", new List<int> {2, 2, 2, 1, 3}},
            {"Африканская (Venda)", new List<int> {3, 2, 2, 1, 4}},
            {"Индийская (Shyam)", new List<int> {2, 1, 2, 2, 3}},
            {"Японская (Taiko)", new List<int> {1, 4, 2, 1, 4}},
            {"Кельтская (Pictish)", new List<int> {2, 1, 2, 2, 3}},
            {"Блюзовая ♭3", new List<int> {2, 1, 2, 1, 3, 2}},
            {"Пентатоника ♯11", new List<int> {2, 2, 2, 1, 3}},
            // Новые лады (50)
            {"Индийская (Kapi)", new List<int> {2, 1, 2, 2, 3}},
            {"Японская (Okinawa)", new List<int> {2, 1, 4, 1, 4}},
            {"Китайская (Bianzhong)", new List<int> {2, 3, 2, 2, 3}},
            {"Тайская (Sukothai)", new List<int> {2, 1, 3, 2, 4}},
            {"Африканская (Akan)", new List<int> {3, 2, 1, 3, 3}},
            {"Индийская (Jhinjhoti)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Японская (Komabue)", new List<int> {1, 4, 1, 4, 2}},
            {"Кельтская (Hebridean)", new List<int> {2, 1, 2, 2, 3}},
            {"Блюзовая ♭6", new List<int> {3, 2, 1, 1, 2, 2, 2}},
            {"Пентатоника ♯13", new List<int> {2, 2, 2, 1, 3}},
            {"Индийская (Deshkar)", new List<int> {2, 2, 1, 2, 3}},
            {"Японская (Nokan)", new List<int> {2, 3, 2, 1, 4}},
            {"Китайская (Yueqin)", new List<int> {2, 3, 2, 2, 3}},
            {"Тайская (Ayutthaya)", new List<int> {2, 1, 3, 2, 4}},
            {"Африканская (Yoruba)", new List<int> {3, 2, 1, 3, 3}},
            {"Индийская (Mianki)", new List<int> {2, 1, 2, 2, 3}},
            {"Японская (Tsugaru)", new List<int> {1, 4, 2, 1, 4}},
            {"Кельтская (Shetland)", new List<int> {2, 1, 2, 2, 3}},
            {"Блюзовая ♯11", new List<int> {3, 2, 2, 1, 3, 1}},
            {"Пентатоника ♭2", new List<int> {1, 3, 2, 3, 3}},
            {"Индийская (Patdeep)", new List<int> {2, 1, 2, 2, 3}},
            {"Японская (Biwa)", new List<int> {2, 1, 4, 1, 4}},
            {"Китайская (Sanxian)", new List<int> {2, 3, 2, 1, 4}},
            {"Тайская (Chiang Mai)", new List<int> {2, 2, 2, 1, 3}},
            {"Африканская (Hausa)", new List<int> {3, 2, 2, 1, 4}},
            {"Индийская (Bageshree)", new List<int> {2, 1, 2, 2, 3}},
            {"Японская (Shamisen)", new List<int> {1, 4, 2, 1, 4}},
            {"Кельтская (Orkney)", new List<int> {2, 1, 2, 2, 3}},
            {"Блюзовая ♭2", new List<int> {1, 3, 1, 1, 3, 2}},
            {"Пентатоника ♯9", new List<int> {3, 1, 2, 3, 3}},
            {"Индийская (Maru)", new List<int> {2, 2, 1, 2, 3}},
            {"Японская (Kagura)", new List<int> {2, 1, 4, 1, 4}},
            {"Китайская (Guzheng)", new List<int> {2, 3, 2, 1, 4}},
            {"Тайская (Lan Chang)", new List<int> {2, 2, 2, 1, 3}},
            {"Африканская (Zulu)", new List<int> {3, 2, 2, 1, 4}},
            {"Индийская (Pahadi)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Японская (Noh)", new List<int> {1, 4, 1, 4, 2}},
            {"Кельтская (Faroese)", new List<int> {2, 1, 2, 2, 3}},
            {"Блюзовая ♯13", new List<int> {3, 2, 1, 1, 3, 1}},
            {"Пентатоника ♭13", new List<int> {2, 2, 1, 3, 3}},
            {"Индийская (Sindhu)", new List<int> {2, 1, 2, 2, 3}},
            {"Японская (Ainu)", new List<int> {2, 1, 4, 1, 4}},
            {"Китайская (Hulusi)", new List<int> {2, 3, 2, 1, 4}},
            {"Тайская (Phin)", new List<int> {2, 2, 2, 1, 3}},
            {"Африканская (Swahili)", new List<int> {3, 2, 2, 1, 4}},
            {"Индийская (Kedara)", new List<int> {2, 2, 1, 2, 3}},
            {"Японская (Kabuki)", new List<int> {1, 4, 2, 1, 4}},
            {"Кельтская (Breton Minor)", new List<int> {2, 1, 2, 2, 3}},
            {"Блюзовая ♭11", new List<int> {3, 2, 1, 1, 2, 2, 2}},
            {"Пентатоника ♯6", new List<int> {2, 2, 2, 1, 3}},
        }
    },
    // Категория: Восточные/Экзотические
    {
        "Восточные/Экзотические", new Dictionary<string, List<int>>
        {
            {"Арабский (Bhairav)", new List<int> {1, 3, 1, 2, 1, 2, 2}},
            {"Индийская (Todi)", new List<int> {1, 2, 2, 2, 2, 2, 1}},
            {"Персидская (Persian)", new List<int> {1, 3, 1, 2, 1, 2, 2}},
            {"Арабская (Hijaz)", new List<int> {1, 3, 1, 2, 1, 3, 1}},
            {"Суфийская (Sufi)", new List<int> {1, 3, 1, 2, 1, 2, 2}},
            {"Двойной гармонический (Double Harm.)", new List<int> {1, 3, 1, 2, 1, 3, 1}},
            {"Венгерский минор (Hungarian Minor)", new List<int> {2, 1, 3, 1, 1, 3, 1}},
            {"Венгерский мажор (Hungarian Major)", new List<int> {3, 1, 2, 1, 2, 1, 2}},
            {"Индийская (Purvi)", new List<int> {1, 3, 1, 2, 2, 2, 1}},
            {"Турецкая (Makam Rast)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Индийская (Bhairavi)", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Греческая (Enigmatic)", new List<int> {1, 3, 2, 1, 2, 1, 2}},
            {"Индийская (Marwa)", new List<int> {1, 3, 2, 2, 2, 1, 1}},
            {"Корейская (Pyeongjo)", new List<int> {2, 2, 3, 2, 3}},
            {"Марокканская (Maqam)", new List<int> {1, 2, 2, 1, 2, 2, 2}},
            {"Индонезийская (Slendro)", new List<int> {2, 2, 3, 3, 2}},
            {"Сирийская (Bayati)", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Индийская (Yaman)", new List<int> {2, 2, 2, 1, 2, 2, 1}},
            {"Индийская (Kafi)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Японская (Ryo)", new List<int> {2, 2, 3, 2, 3}},
            {"Тунисская (Tunisian)", new List<int> {1, 3, 1, 2, 1, 2, 2}},
            {"Индийская (Darbari)", new List<int> {2, 1, 2, 2, 1, 3, 1}},
            {"Камбоджийская (Khmer)", new List<int> {2, 2, 3, 2, 3}},
            {"Ливанская (Lebanese)", new List<int> {1, 3, 1, 2, 1, 3, 1}},
            {"Азербайджанская (Mugham)", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Казахская (Kazakh)", new List<int> {2, 1, 3, 1, 2, 2, 1}},
            {"Индийская (Bageshri)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Монгольская (Throat)", new List<int> {2, 2, 3, 2, 3}},
            {"Иракская (Iraqi)", new List<int> {1, 3, 1, 2, 1, 2, 2}},
            {"Узбекская (Uzbek)", new List<int> {2, 1, 3, 1, 2, 2, 1}},
            {"Йеменская (Yemeni)", new List<int> {1, 3, 1, 2, 1, 3, 1}},
            {"Туркменская (Turkmen)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Индийская (Asavari)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Турецкая (Hicazkar)", new List<int> {1, 3, 1, 2, 1, 3, 1}},
            {"Персидская (Shur)", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Индийская (Desh)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Арабская (Nahawand)", new List<int> {2, 1, 2, 2, 1, 3, 1}},
            {"Японская (Sakura)", new List<int> {1, 4, 2, 1, 4}},
            {"Индийская (Kalyan)", new List<int> {2, 2, 2, 1, 2, 2, 1}},
            {"Тайская (Phimai)", new List<int> {2, 2, 1, 3, 2, 2}},
            {"Китайская (Gong)", new List<int> {2, 2, 3, 2, 3}},
            {"Индийская (Pilu)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Турецкая (Segah)", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Индийская (Jaunpuri)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Персидская (Bayat-e Esfahan)", new List<int> {2, 1, 2, 1, 2, 2, 2}},
            {"Арабская (Saba)", new List<int> {1, 2, 1, 2, 2, 2, 2}},
            {"Индийская (Bhairav Thaat)", new List<int> {1, 3, 1, 2, 1, 2, 2}},
            {"Тайская (Khlui)", new List<int> {2, 2, 2, 1, 3, 2}},
            {"Китайская (Zhi)", new List<int> {2, 2, 1, 2, 3, 2}},
            {"Индийская (Jog)", new List<int> {2, 2, 1, 2, 1, 2, 2}},
            {"Узбекская (Navoi)", new List<int> {2, 1, 3, 1, 2, 1, 2}},
            {"Монгольская (Urtyn Duu)", new List<int> {2, 2, 3, 2, 3}},
            {"Индийская (Shankarabharanam)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Турецкая (Ussak)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Персидская (Dastgah-e Shur)", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Арабская (Rast Panjgah)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Индийская (Kamavardhani)", new List<int> {1, 3, 1, 2, 2, 1, 2}},
            {"Тайская (Ranad)", new List<int> {2, 2, 1, 3, 2, 2}},
            {"Китайская (Shang)", new List<int> {2, 3, 2, 1, 4}},
            {"Индийская (Charukesi)", new List<int> {2, 2, 1, 2, 1, 2, 2}},
            {"Узбекская (Buzruk)", new List<int> {2, 1, 3, 1, 2, 2, 1}},
            {"Монгольская (Khuumii)", new List<int> {2, 3, 2, 2, 3}},
            {"Турецкая (Kurdilihicazkar)", new List<int> {1, 3, 1, 2, 1, 3, 1}},
            {"Индийская (Natabhairavi)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Персидская (Mahur)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Арабская (Ajam)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Индийская (Shuddha Dhanyasi)", new List<int> {2, 1, 2, 3, 4}},
            {"Тайская (Nok)", new List<int> {2, 1, 3, 2, 3, 1}},
            {"Китайская (Jue)", new List<int> {3, 2, 2, 3, 2}},
            {"Индийская (Hemavati)", new List<int> {2, 1, 3, 1, 2, 1, 2}},
            {"Узбекская (Rast)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Монгольская (Bayati)", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            // Новые лады (100)
            {"Индийская (Kalyani)", new List<int> {2, 2, 2, 1, 2, 2, 1}},
            {"Турецкая (Huzzam)", new List<int> {1, 2, 2, 2, 1, 3, 1}},
            {"Арабская (Suznak)", new List<int> {2, 1, 2, 2, 1, 3, 1}},
            {"Индийская (Rageshri)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Тайская (Pathet)", new List<int> {2, 2, 1, 3, 2, 2}},
            {"Китайская (Guqin)", new List<int> {2, 3, 2, 1, 4}},
            {"Индийская (Shanmukhapriya)", new List<int> {2, 1, 3, 1, 2, 1, 2}},
            {"Узбекская (Shashmaqom)", new List<int> {2, 1, 3, 1, 2, 2, 1}},
            {"Монгольская (Morin Khuur)", new List<int> {2, 2, 3, 2, 3}},
            {"Турецкая (Nihavent)", new List<int> {2, 1, 2, 2, 1, 3, 1}},
            {"Индийская (Dhenuka)", new List<int> {2, 1, 3, 1, 2, 2, 1}},
            {"Персидская (Segah)", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Арабская (Hijaz Kar)", new List<int> {1, 3, 1, 2, 1, 3, 1}},
            {"Индийская (Kedar)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Тайская (Sralai)", new List<int> {2, 1, 3, 2, 3, 1}},
            {"Китайская (Erhu)", new List<int> {2, 2, 3, 2, 3}},
            {"Индийская (Mayamalavagowla)", new List<int> {2, 1, 3, 1, 2, 2, 1}},
            {"Узбекская (Tanbur)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Монгольская (Yatga)", new List<int> {2, 3, 2, 2, 3}},
            {"Турецкая (Sultaniyegah)", new List<int> {1, 2, 2, 2, 1, 3, 1}},
            {"Индийская (Gowrimanohari)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Персидская (Chahargah)", new List<int> {1, 3, 1, 2, 1, 2, 2}},
            {"Арабская (Bayati Shuri)", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Индийская (Bhavapriya)", new List<int> {1, 3, 1, 2, 2, 1, 2}},
            {"Тайская (Pin)", new List<int> {2, 2, 1, 3, 2, 2}},
            {"Китайская (Xiao)", new List<int> {2, 2, 3, 2, 3}},
            {"Индийская (Suryakantam)", new List<int> {2, 1, 3, 1, 2, 1, 2}},
            {"Узбекская (Dutar)", new List<int> {2, 1, 3, 1, 2, 2, 1}},
            {"Монгольская (Tsuur)", new List<int> {2, 3, 2, 2, 3}},
            {"Турецкая (Bestenigar)", new List<int> {1, 2, 2, 2, 1, 3, 1}},
            {"Индийская (Dharmavati)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Персидская (Rast-Panjgah)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Арабская (Kurd)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Индийская (Chakravakam)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Тайская (Chakhe)", new List<int> {2, 2, 1, 3, 2, 2}},
            {"Китайская (Dizi)", new List<int> {2, 3, 2, 1, 4}},
            {"Индийская (Vagadheeswari)", new List<int> {2, 1, 3, 1, 2, 2, 1}},
            {"Узбекская (Rubab)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Монгольская (Shudarga)", new List<int> {2, 2, 3, 2, 3}},
            {"Турецкая (Huseyni)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Индийская (Hanumatodi)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Персидская (Homayun)", new List<int> {1, 3, 1, 2, 1, 2, 2}},
            {"Арабская (Sikah)", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Индийская (Gamanashrama)", new List<int> {2, 1, 3, 1, 2, 1, 2}},
            {"Тайская (Saw)", new List<int> {2, 2, 1, 3, 2, 2}},
            {"Китайская (Sheng)", new List<int> {2, 3, 2, 1, 4}},
            {"Индийская (Kokilapriya)", new List<int> {2, 1, 3, 1, 2, 2, 1}},
            {"Узбекская (Sato)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Монгольская (Ikh Khuur)", new List<int> {2, 2, 3, 2, 3}},
            {"Турецкая (Saba Zemzeme)", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Индийская (Ramapriya)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Персидская (Dasht-e Arzoo)", new List<int> {1, 3, 1, 2, 1, 2, 2}},
            {"Арабская (Hijaz Kar Kurd)", new List<int> {1, 3, 1, 2, 1, 3, 1}},
            {"Индийская (Senavati)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Тайская (Khong)", new List<int> {2, 2, 1, 3, 2, 2}},
            {"Китайская (Yangqin)", new List<int> {2, 3, 2, 1, 4}},
            {"Индийская (Harikambhoji)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Узбекская (Ghidjak)", new List<int> {2, 1, 3, 1, 2, 2, 1}},
            {"Монгольская (Limbe)", new List<int> {2, 2, 3, 2, 3}},
            {"Турецкая (Acem)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Индийская (Kharaharapriya)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Персидская (Bayat-e Turk)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Арабская (Nawa Athar)", new List<int> {1, 3, 1, 2, 1, 2, 2}},
            {"Индийская (Ganamurti)", new List<int> {2, 1, 3, 1, 2, 2, 1}},
            {"Тайская (Ranat)", new List<int> {2, 2, 1, 3, 2, 2}},
            {"Китайская (Banhu)", new List<int> {2, 3, 2, 1, 4}},
            {"Индийская (Navaneetam)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Узбекская (Chang)", new List<int> {2, 1, 3, 1, 2, 2, 1}},
            {"Монгольская (Tovshuur)", new List<int> {2, 2, 3, 2, 3}},
            {"Турецкая (Suzidil)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Индийская (Pavani)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Персидская (Bayat-e Zand)", new List<int> {1, 3, 1, 2, 1, 2, 2}},
            {"Арабская (Shahnaz)", new List<int> {1, 3, 1, 2, 1, 3, 1}},
            {"Индийская (Rupavati)", new List<int> {2, 1, 3, 1, 2, 2, 1}},
            {"Тайская (Pi)", new List<int> {2, 2, 1, 3, 2, 2}},
            {"Китайская (Gaohu)", new List<int> {2, 3, 2, 1, 4}},
            {"Индийская (Gavambodhi)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Узбекская (Nay)", new List<int> {2, 1, 3, 1, 2, 2, 1}},
            {"Монгольская (Shanz)", new List<int> {2, 2, 3, 2, 3}},
            {"Турецкая (Beyati)", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Индийская (Bhairav Bahar)", new List<int> {1, 3, 1, 2, 1, 2, 2}},
            {"Персидская (Afshari)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Арабская (Rahat al-Arwah)", new List<int> {1, 3, 1, 2, 1, 3, 1}},
            {"Индийская (Kalyani Yaman)", new List<int> {2, 2, 2, 1, 2, 2, 1}},
            {"Тайская (Thon)", new List<int> {2, 2, 1, 3, 2, 2}},
            {"Китайская (Liuqin)", new List<int> {2, 3, 2, 1, 4}},
            {"Индийская (Sarasangi)", new List<int> {2, 1, 3, 1, 2, 2, 1}},
            {"Узбекская (Karnay)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Монгольская (Hoomei)", new List<int> {2, 2, 3, 2, 3}},
            {"Турецкая (Mahur)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Индийская (Vasantha)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Персидская (Bayat-e Kord)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Арабская (Hijaz Nawah)", new List<int> {1, 3, 1, 2, 1, 3, 1}},
            {"Индийская (Jyoti)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Тайская (Khong Wong)", new List<int> {2, 2, 1, 3, 2, 2}},
            {"Китайская (Ruan)", new List<int> {2, 3, 2, 1, 4}},
            {"Индийская (Latangi)", new List<int> {2, 1, 3, 1, 2, 2, 1}},
            {"Узбекская (Doira)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Монгольская (Choor)", new List<int> {2, 2, 3, 2, 3}},
            // Добавленные еврейские лады
            {"Еврейский (Ahava Rabbah)", new List<int> {1, 3, 1, 2, 1, 2, 2}},
            {"Еврейский (Magen Avot)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Еврейский (Mi Sheberach)", new List<int> {2, 1, 2, 2, 2, 1, 2}},
            {"Еврейский (Adonai Malach)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Еврейский (Klezmer Phrygian)", new List<int> {1, 2, 2, 2, 1, 3, 1}},
            {"Еврейский (Yishtabach)", new List<int> {2, 2, 1, 2, 1, 2, 2}},
            {"Еврейский (Freygish)", new List<int> {1, 3, 1, 2, 1, 2, 2}}, // Альтернативное название для Ahava Rabbah
            {"Еврейский (Misheberach Minor)", new List<int> {2, 1, 2, 2, 1, 3, 1}},
            {"Еврейский (Klezmer Major)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Еврейский (Shabbat Mode)", new List<int> {2, 1, 2, 2, 2, 1, 2}},
            {"Индийская (Shri)", new List<int> {1, 3, 1, 2, 1, 2, 2}},
            {"Индийская (Hindol)", new List<int> {2, 2, 2, 3, 3}},
            {"Индийская (Tilak Kamod)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Индийская (Chandrakauns)", new List<int> {2, 1, 3, 2, 4}},
            {"Индийская (Shuddha Sarali)", new List<int> {2, 1, 2, 2, 2, 2, 1}},
            {"Турецкая (Çargah)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Турецкая (Buselik)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Турецкая (Isfahanek)", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Турецкая (Nişaburek)", new List<int> {1, 3, 1, 2, 1, 3, 1}},
            {"Турецкая (Hüzzam Segah)", new List<int> {1, 2, 2, 2, 1, 3, 1}},
            {"Персидская (Nava)", new List<int> {2, 1, 2, 2, 1, 2, 2}}
        }
    },
    // Категория: Арабские макаматы
    {
        "Арабские макаматы", new Dictionary<string, List<int>>
        {
            {"Раст (راست - Rast)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Баяти (بياتي - Bayati)", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Сика (سيكاه - Sikah)", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Хиджаз (حجاز - Hijaz)", new List<int> {1, 3, 1, 2, 1, 3, 1}},
            {"Хиджаз Кар (حجاز كار - Hijaz Kar)", new List<int> {1, 3, 1, 2, 1, 3, 1}},
            {"Нахаванд (نهاوند - Nahawand)", new List<int> {2, 1, 2, 2, 1, 3, 1}},
            {"Курд (كرد - Kurd)", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Адшам (عجم - Ajam)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Саба (صبا - Saba)", new List<int> {1, 2, 1, 2, 2, 2, 2}},
            {"Сузнак (سوزناك - Suznak)", new List<int> {2, 1, 2, 2, 1, 3, 1}},
            {"Хуззам (هزام - Huzzam)", new List<int> {1, 2, 2, 2, 1, 3, 1}},
            {"Бастанигар (بستنكار - Bastanigar)", new List<int> {1, 2, 2, 2, 1, 3, 1}},
            {"Шахназ (شهناز - Shahnaz)", new List<int> {1, 3, 1, 2, 1, 3, 1}},
            {"Рахат аль-Арвах (راحة الأرواح - Rahat al-Arwah)", new List<int> {1, 3, 1, 2, 1, 3, 1}},
            {"Нихавент (نهاوند - Nihavent)", new List<int> {2, 1, 2, 2, 1, 3, 1}},
            {"Хусейни (حسيني - Husayni)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Баяти Шури (بياتي شوري - Bayati Shuri)", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Раст Панжгах (راست پنجگاه - Rast Panjgah)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Курдилихиджазкар (كرديلهجازكار - Kurdilihijazkar)", new List<int> {1, 3, 1, 2, 1, 3, 1}},
            {"Сабаземземе (صبا زمزمة - Saba Zemzeme)", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Хиджаз Навва (حجاز نوا - Hijaz Nawah)", new List<int> {1, 3, 1, 2, 1, 3, 1}},
            {"Адшам Ашир (عجم عاشير - Ajam Ashir)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Суздиль (سوزديل - Suzidil)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Султанийегях (سلطاني يگاه - Sultaniyegah)", new List<int> {1, 2, 2, 2, 1, 3, 1}},
            {"Нахаванд Курд (نهاوند كرد - Nahawand Kurd)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Хиджаз Кар Курд (حجاز كار كرد - Hijaz Kar Kurd)", new List<int> {1, 3, 1, 2, 1, 3, 1}},
            {"Сика Балди (سيكاه بلدي - Sikah Baladi)", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Рамаль (رمل - Ramal)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Шадд Арабан (شد عربان - Shadd Araban)", new List<int> {1, 3, 1, 2, 1, 2, 2}},
            {"Зангула (زنكولة - Zangula)", new List<int> {1, 2, 2, 2, 1, 3, 1}},
            {"Махур (ماهور - Mahur)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Бузург (بزرگ - Buzurg)", new List<int> {2, 1, 3, 1, 2, 2, 1}},
            {"Ирак (عراق - Iraq)", new List<int> {1, 3, 1, 2, 1, 2, 2}},
            {"Исфахан (أصفهان - Isfahan)", new List<int> {2, 1, 2, 1, 2, 2, 2}},
            {"Джигархан (جكارخان - Jigarkhan)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Харидж Хиджаз (خارج حجاز - Kharaj Hijaz)", new List<int> {1, 3, 1, 2, 1, 3, 1}},
            {"Фарахфеза (فرحفزا - Farahfaza)", new List<int> {2, 2, 1, 2, 1, 2, 2}},
            {"Шуштар (شوشتر - Shushtar)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Накш (نقش - Naqsh)", new List<int> {2, 1, 2, 2, 1, 3, 1}},
            {"Баяти Курд (بياتي كرد - Bayati Kurd)", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Хиджаз Ашир (حجاز عاشير - Hijaz Ashir)", new List<int> {1, 3, 1, 2, 1, 3, 1}},
            {"Сузнак Курд (سوزناك كرد - Suznak Kurd)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Раст Курд (راست كرد - Rast Kurd)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Сика Хузам (سيكاه هزام - Sikah Huzam)", new List<int> {1, 2, 2, 2, 1, 3, 1}},
            {"Нахаванд Хиджаз (نهاوند حجاز - Nahawand Hijaz)", new List<int> {2, 1, 2, 2, 1, 3, 1}},
            {"Курд Хиджаз (كرد حجاز - Kurd Hijaz)", new List<int> {1, 2, 2, 2, 1, 3, 1}},
            {"Адшам Мурраса (عجم مرصع - Ajam Murrasa)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Саба Далансин (صبا دلنشين - Saba Dalansin)", new List<int> {1, 2, 1, 2, 2, 2, 2}},
            {"Хуззам Курд (هزام كرد - Huzzam Kurd)", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Бастанигар Курд (بستنكار كرد - Bastanigar Kurd)", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Шахназ Курд (شهناز كرد - Shahnaz Kurd)", new List<int> {1, 3, 1, 2, 1, 2, 2}},
            {"Рахат аль-Арвах Курд (راحة الأرواح كرد - Rahat al-Arwah Kurd)", new List<int> {1, 3, 1, 2, 1, 2, 2}},
            {"Нихавент Хиджаз (نهاوند حجاز - Nihavent Hijaz)", new List<int> {2, 1, 2, 2, 1, 3, 1}},
            {"Хусейни Курд (حسيني كرد - Husayni Kurd)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Баяти Шури Курд (بياتي شوري كرد - Bayati Shuri Kurd)", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Раст Панжгах Курд (راست پنجگاه كرد - Rast Panjgah Kurd)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Курдилихиджазкар Курд (كرديلهجازكار كرد - Kurdilihijazkar Kurd)", new List<int> {1, 3, 1, 2, 1, 2, 2}},
            {"Сабаземземе Курд (صبا زمزمة كرد - Saba Zemzeme Kurd)", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Хиджаз Навва Курд (حجاز نوا كرد - Hijaz Nawah Kurd)", new List<int> {1, 3, 1, 2, 1, 2, 2}},
            {"Адшам Ашир Курд (عجم عاشير كرد - Ajam Ashir Kurd)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Суздиль Курд (سوزديل كرد - Suzidil Kurd)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Султанийегях Курд (سلطاني يگاه كرد - Sultaniyegah Kurd)", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Нахаванд Хиджаз Кар (نهاوند حجاز كار - Nahawand Hijaz Kar)", new List<int> {2, 1, 2, 2, 1, 3, 1}},
            {"Хиджаз Кар Курд Ашир (حجاز كار كرد عاشير - Hijaz Kar Kurd Ashir)", new List<int> {1, 3, 1, 2, 1, 2, 2}},
            {"Сика Балди Курд (سيكاه بلدي كرد - Sikah Baladi Kurd)", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Рамаль Курд (رمل كرد - Ramal Kurd)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Шадд Арабан Курд (شد عربان كرد - Shadd Araban Kurd)", new List<int> {1, 3, 1, 2, 1, 2, 2}},
            {"Зангула Курд (زنكولة كرد - Zangula Kurd)", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Махур Курд (ماهور كرد - Mahur Kurd)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Бузург Курд (بزرگ كرد - Buzurg Kurd)", new List<int> {2, 1, 3, 1, 2, 1, 2}},
            {"Ирак Курд (عراق كرد - Iraq Kurd)", new List<int> {1, 3, 1, 2, 1, 2, 2}},
            {"Исфахан Курд (أصفهان كرد - Isfahan Kurd)", new List<int> {2, 1, 2, 1, 2, 2, 2}},
            {"Джигархан Курд (جكارخان كرد - Jigarkhan Kurd)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Харидж Хиджаз Курд (خارج حجاز كرد - Kharaj Hijaz Kurd)", new List<int> {1, 3, 1, 2, 1, 2, 2}},
            {"Фарахфеза Курд (فرحفزا كرد - Farahfaza Kurd)", new List<int> {2, 2, 1, 2, 1, 2, 2}},
            {"Шуштар Курд (شوشتر كرد - Shushtar Kurd)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Накш Курд (نقش كرد - Naqsh Kurd)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Баяти Ашир (بياتي عاشير - Bayati Ashir)", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Хиджаз Ашир Курд (حجاز عاشير كرد - Hijaz Ashir Kurd)", new List<int> {1, 3, 1, 2, 1, 2, 2}},
            {"Сузнак Ашир (سوزناك عاشير - Suznak Ashir)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Раст Ашир (راست عاشير - Rast Ashir)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Сика Хузам Ашир (سيكاه هزام عاشير - Sikah Huzam Ashir)", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Нахаванд Ашир (نهاوند عاشير - Nahawand Ashir)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Курд Ашир (كرد عاشير - Kurd Ashir)", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Адшам Мурраса Ашир (عجم مرصع عاشير - Ajam Murrasa Ashir)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Саба Далансин Ашир (صبا دلنشين عاشير - Saba Dalansin Ashir)", new List<int> {1, 2, 1, 2, 2, 2, 2}},
            {"Хуззам Ашир (هزام عاشير - Huzzam Ashir)", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Бастанигар Ашир (بستنكار عاشير - Bastanigar Ashir)", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Шахназ Ашир (شهناز عاشير - Shahnaz Ashir)", new List<int> {1, 3, 1, 2, 1, 2, 2}},
            {"Рахат аль-Арвах Ашир (راحة الأرواح عاشير - Rahat al-Arwah Ashir)", new List<int> {1, 3, 1, 2, 1, 2, 2}},
            {"Нихавент Ашир (نهاوند عاشير - Nihavent Ashir)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Хусейни Ашир (حسيني عاشير - Husayni Ashir)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Баяти Шури Ашир (بياتي شوري عاشير - Bayati Shuri Ashir)", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Раст Панжгах Ашир (راست پنجگاه عاشير - Rast Panjgah Ashir)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Курдилихиджазкар Ашир (كرديلهجازكار عاشير - Kurdilihijazkar Ashir)", new List<int> {1, 3, 1, 2, 1, 2, 2}},
            {"Сабаземземе Ашир (صبا زمزمة عاشير - Saba Zemzeme Ashir)", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Хиджаз Навва Ашир (حجاز نوا عاشير - Hijaz Nawah Ashir)", new List<int> {1, 3, 1, 2, 1, 2, 2}},
            {"Адшам Ашир Ашир (عجم عاشير عاشير - Ajam Ashir Ashir)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Суздиль Ашир (سوزديل عاشير - Suzidil Ashir)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Султанийегях Ашир (سلطاني يگاه عاشير - Sultaniyegah Ashir)", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Нахаванд Хиджаз Ашир (نهاوند حجاز عاشير - Nahawand Hijaz Ashir)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Хиджаз Кар Ашир (حجاز كار عاشير - Hijaz Kar Ashir)", new List<int> {1, 3, 1, 2, 1, 2, 2}},
            {"Сика Балди Ашир (سيكاه بلدي عاشير - Sikah Baladi Ashir)", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Рамаль Ашир (رمل عاشير - Ramal Ashir)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Шадд Арабан Ашир (شد عربان عاشير - Shadd Araban Ashir)", new List<int> {1, 3, 1, 2, 1, 2, 2}},
            {"Зангула Ашир (زنكولة عاشير - Zangula Ashir)", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Махур Ашир (ماهور عاشير - Mahur Ashir)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Бузург Ашир (بزرگ عاشير - Buzurg Ashir)", new List<int> {2, 1, 3, 1, 2, 1, 2}},
            {"Ирак Ашир (عراق عاشير - Iraq Ashir)", new List<int> {1, 3, 1, 2, 1, 2, 2}},
            {"Исфахан Ашир (أصفهان عاشير - Isfahan Ashir)", new List<int> {2, 1, 2, 1, 2, 2, 2}},
            {"Джигархан Ашир (جكارخان عاشير - Jigarkhan Ashir)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Харидж Хиджаз Ашир (خارج حجاز عاشير - Kharaj Hijaz Ashir)", new List<int> {1, 3, 1, 2, 1, 2, 2}},
            {"Фарахфеза Ашир (فرحفزا عاشير - Farahfaza Ashir)", new List<int> {2, 2, 1, 2, 1, 2, 2}},
            {"Шуштар Ашир (شوشتر عاشير - Shushtar Ashir)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Накш Ашир (نقش عاشير - Naqsh Ashir)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Баяти Хиджаз (بياتي حجاز - Bayati Hijaz)", new List<int> {1, 2, 2, 2, 1, 3, 1}},
            {"Хиджаз Сика (حجاز سيكاه - Hijaz Sikah)", new List<int> {1, 3, 1, 2, 1, 2, 2}},
            {"Сузнак Сика (سوزناك سيكاه - Suznak Sikah)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Раст Сика (راست سيكاه - Rast Sikah)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Сика Нахаванд (سيكاه نهاوند - Sikah Nahawand)", new List<int> {1, 2, 2, 2, 1, 3, 1}},
            {"Нахаванд Сика (نهاوند سيكاه - Nahawand Sikah)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Курд Сика (كرد سيكاه - Kurd Sikah)", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Адшам Сика (عجم سيكاه - Ajam Sikah)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Саба Сика (صبا سيكاه - Saba Sikah)", new List<int> {1, 2, 1, 2, 2, 2, 2}},
            {"Хуззам Сика (هزام سيكاه - Huzzam Sikah)", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Бастанигар Сика (بستنكار سيكاه - Bastanigar Sikah)", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Шахназ Сика (شهناز سيكاه - Shahnaz Sikah)", new List<int> {1, 3, 1, 2, 1, 2, 2}},
            {"Рахат аль-Арвах Сика (راحة الأرواح سيكاه - Rahat al-Arwah Sikah)", new List<int> {1, 3, 1, 2, 1, 2, 2}},
            {"Нихавент Сика (نهاوند سيكاه - Nihavent Sikah)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Хусейни Сика (حسيني سيكاه - Husayni Sikah)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Баяти Шури Сика (بياتي شوري سيكاه - Bayati Shuri Sikah)", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Раст Панжгах Сика (راست پنجگاه سيكاه - Rast Panjgah Sikah)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Курдилихиджазкар Сика (كرديلهجازكار سيكاه - Kurdilihijazkar Sikah)", new List<int> {1, 3, 1, 2, 1, 2, 2}},
            {"Сабаземземе Сика (صبا زمزمة سيكاه - Saba Zemzeme Sikah)", new List<int> {1, 2, 2, 2, 1, 2, 2}},
            {"Хиджаз Навва Сика (حجاز نوا سيكاه - Hijaz Nawah Sikah)", new List<int> {1, 3, 1, 2, 1, 2, 2}}
        }
    },
    // Категория: Европейские/Фольклорные
    {
        "Европейские/Фольклорные", new Dictionary<string, List<int>>
        {
            {"Испанский фригийский (Spanish Phrygian)", new List<int> {1, 3, 1, 2, 1, 2, 2}},
            {"Балканская (Balkan)", new List<int> {1, 3, 2, 1, 2, 2, 1}},
            {"Цыганская (Gypsy)", new List<int> {1, 3, 2, 1, 1, 3, 1}},
            {"Кельтская (Celtic)", new List<int> {2, 1, 2, 2, 2, 1, 2}},
            {"Фламенко (Flamenco)", new List<int> {1, 3, 1, 2, 1, 2, 2}},
            {"Гавайская (Hawaiian)", new List<int> {2, 1, 2, 2, 3, 2}},
            {"Румынская (Romanian Minor)", new List<int> {2, 1, 3, 1, 2, 1, 2}},
            {"Ирландская (Irish)", new List<int> {2, 1, 2, 2, 2, 2, 1}},
            {"Северная (Nordic)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Шотландская (Scottish)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Польская (Mazurka)", new List<int> {2, 1, 2, 2, 1, 3, 1}},
            {"Русская (Russian Minor)", new List<int> {2, 1, 2, 2, 1, 3, 1}},
            {"Испанская (Andalusian)", new List<int> {1, 2, 2, 1, 2, 2, 2}},
            {"Тайская (Thai)", new List<int> {2, 2, 1, 2, 3, 2}},
            {"Чешская (Bohemian)", new List<int> {2, 1, 3, 1, 2, 2, 1}},
            {"Литовская (Lithuanian)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Французская (Chanson)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Украинская (Ukrainian)", new List<int> {2, 1, 3, 1, 1, 3, 1}},
            {"Бирманская (Burmese)", new List<int> {2, 2, 2, 3, 3}},
            {"Португальская (Fado)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Армянская (Armenian)", new List<int> {1, 3, 1, 2, 2, 2, 1}},
            {"Грузинская (Georgian)", new List<int> {2, 1, 3, 1, 2, 1, 2}},
            {"Непальская (Nepali)", new List<int> {2, 2, 2, 1, 2, 2, 1}},
            {"Исландская (Icelandic)", new List<int> {2, 1, 2, 2, 2, 1, 2}},
            {"Болгарская (Bulgarian)", new List<int> {1, 2, 3, 1, 2, 2, 1}},
            {"Итальянская (Tarantella)", new List<int> {2, 1, 2, 2, 1, 3, 1}},
            {"Белорусская (Belarusian)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Финская (Finnish)", new List<int> {2, 1, 2, 2, 2, 1, 2}},
            {"Сербийская (Serbian)", new List<int> {1, 3, 2, 1, 2, 2, 1}},
            {"Эстонская (Estonian)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Норвежская (Norwegian)", new List<int> {2, 1, 2, 2, 2, 1, 2}},
            {"Хорватская (Croatian)", new List<int> {1, 3, 2, 1, 2, 2, 1}},
            {"Галисийская (Galician)", new List<int> {2, 1, 2, 2, 1, 3, 1}},
            {"Словацкая (Slovak)", new List<int> {2, 1, 3, 1, 2, 1, 2}},
            {"Валлийская (Welsh)", new List<int> {2, 1, 2, 2, 2, 1, 2}},
            {"Баскская (Basque)", new List<int> {1, 3, 1, 2, 1, 2, 2}},
            {"Македонская (Macedonian)", new List<int> {1, 2, 3, 1, 2, 2, 1}},
            {"Латвийская (Latvian)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Саамская (Sami)", new List<int> {2, 2, 1, 2, 2, 3}},
            {"Каталонская (Catalan)", new List<int> {2, 1, 3, 1, 2, 2, 1}},
            {"Сардинская (Sardinian)", new List<int> {1, 3, 1, 2, 2, 2, 1}},
            {"Албанская (Çifteli)", new List<int> {1, 3, 2, 1, 2, 2, 1}},
            {"Бретонская (Breizh)", new List<int> {2, 1, 2, 2, 2, 2, 1}},
            {"Словенская (Slovenska)", new List<int> {2, 1, 3, 1, 2, 1, 2}},
            {"Корсиканская (Corsican)", new List<int> {1, 2, 2, 2, 1, 3, 1}},
            {"Швейцарская (Alpine)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Молдавская (Moldovan)", new List<int> {2, 1, 3, 1, 1, 3, 1}},
            {"Фламандская (Flemish)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Лапландская (Lappish)", new List<int> {2, 2, 2, 1, 2, 3}},
            {"Сицилийская (Sicilian)", new List<int> {1, 3, 1, 2, 1, 2, 2}},
            {"Боснийская (Bosnian)", new List<int> {1, 2, 3, 1, 2, 2, 1}},
            {"Критская (Cretan)", new List<int> {2, 1, 2, 2, 1, 3, 1}},
            {"Датская (Danish)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Австрийская (Tyrolean)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Гэльская (Gaelic)", new List<int> {2, 1, 2, 2, 2, 1, 2}},
            {"Кипрская (Cypriot)", new List<int> {1, 3, 1, 2, 2, 2, 1}},
            // Новые лады (70)
            {"Греческая (Chromatic Dorian)", new List<int> {2, 1, 2, 2, 2, 1, 2}},
            {"Венгерская (Verbunkos)", new List<int> {2, 1, 3, 1, 2, 1, 2}},
            {"Румынская (Doina)", new List<int> {2, 1, 2, 2, 1, 3, 1}},
            {"Ирландская (Sean-nós)", new List<int> {2, 1, 2, 2, 2, 2, 1}},
            {"Шведская (Polska)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Польская (Oberek)", new List<int> {2, 1, 2, 2, 1, 3, 1}},
            {"Русская (Bylina)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Испанская (Malagueña)", new List<int> {1, 3, 1, 2, 1, 2, 2}},
            {"Итальянская (Canzone)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Французская (Musette)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Украинская (Duma)", new List<int> {2, 1, 3, 1, 1, 3, 1}},
            {"Болгарская (Rachenitsa)", new List<int> {1, 2, 3, 1, 2, 2, 1}},
            {"Сербская (Kolo)", new List<int> {1, 3, 2, 1, 2, 2, 1}},
            {"Хорватская (Tamburica)", new List<int> {1, 3, 2, 1, 2, 2, 1}},
            {"Галисийская (Muiñeira)", new List<int> {2, 1, 2, 2, 1, 3, 1}},
            {"Словацкая (Čardáš)", new List<int> {2, 1, 3, 1, 2, 1, 2}},
            {"Валлийская (Hiraeth)", new List<int> {2, 1, 2, 2, 2, 1, 2}},
            {"Баскская (Zortziko)", new List<int> {1, 3, 1, 2, 1, 2, 2}},
            {"Македонская (Oro)", new List<int> {1, 2, 3, 1, 2, 2, 1}},
            {"Латвийская (Daina)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Саамская (Joik)", new List<int> {2, 2, 1, 2, 2, 3}},
            {"Каталонская (Sardana)", new List<int> {2, 1, 3, 1, 2, 2, 1}},
            {"Сардинская (Cantu)", new List<int> {1, 3, 1, 2, 2, 2, 1}},
            {"Албанская (Iso-Polyphony)", new List<int> {1, 3, 2, 1, 2, 2, 1}},
            {"Бретонская (Kan Ha Diskan)", new List<int> {2, 1, 2, 2, 2, 2, 1}},
            {"Словенская (Ljudska)", new List<int> {2, 1, 3, 1, 2, 1, 2}},
            {"Корсиканская (Paghjella)", new List<int> {1, 2, 2, 2, 1, 3, 1}},
            {"Швейцарская (Jodel)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Молдавская (Horo)", new List<int> {2, 1, 3, 1, 1, 3, 1}},
            {"Фламандская (Volkslied)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Лапландская (Reindeer)", new List<int> {2, 2, 2, 1, 2, 3}},
            {"Сицилийская (Siciliana)", new List<int> {1, 3, 1, 2, 1, 2, 2}},
            {"Боснийская (Sevdalinka)", new List<int> {1, 2, 3, 1, 2, 2, 1}},
            {"Критская (Rizitiko)", new List<int> {2, 1, 2, 2, 1, 3, 1}},
            {"Датская (Folkevise)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Австрийская (Ländler)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Гэльская (Puirt à Beul)", new List<int> {2, 1, 2, 2, 2, 1, 2}},
            {"Кипрская (Tsiattista)", new List<int> {1, 3, 1, 2, 2, 2, 1}},
            {"Немецкая (Volksmusik)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Шотландская (Pibroch)", new List<int> {2, 1, 2, 2, 2, 1, 2}},
            {"Исландская (Rímur)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Эстонская (Regilaul)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Литовская (Sutartinė)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Финская (Kalevala)", new List<int> {2, 1, 2, 2, 2, 1, 2}},
            {"Норвежская (Stev)", new List<int> {2, 1, 2, 2, 2, 1, 2}},
            {"Белорусская (Kolyada)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Чешская (Lidová)", new List<int> {2, 1, 3, 1, 2, 2, 1}},
            {"Португальская (Canto)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Грузинская (Chakrulo)", new List<int> {2, 1, 3, 1, 2, 1, 2}},
            {"Армянская (Duduk)", new List<int> {1, 3, 1, 2, 2, 2, 1}},
            {"Балканская (Izvorna)", new List<int> {1, 3, 2, 1, 2, 2, 1}},
            {"Швейцарская (Ranz)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Словенская (Kajkavian)", new List<int> {2, 1, 3, 1, 2, 1, 2}},
            {"Корсиканская (Lamentu)", new List<int> {1, 2, 2, 2, 1, 3, 1}},
            {"Саамская (Leudd)", new List<int> {2, 2, 1, 2, 2, 3}},
            {"Каталонская (Havanera)", new List<int> {2, 1, 3, 1, 2, 2, 1}},
            {"Сардинская (Tenore)", new List<int> {1, 3, 1, 2, 2, 2, 1}},
            {"Албанская (Këngë)", new List<int> {1, 3, 2, 1, 2, 2, 1}},
            {"Бретонская (Gwerz)", new List<int> {2, 1, 2, 2, 2, 2, 1}},
            {"Словенская (Ziljska)", new List<int> {2, 1, 3, 1, 2, 1, 2}},
            {"Корсиканская (Voceru)", new List<int> {1, 2, 2, 2, 1, 3, 1}},
            {"Швейцарская (Schwyzer)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Молдавская (Manea)", new List<int> {2, 1, 3, 1, 1, 3, 1}},
            {"Фламандская (Kempisch)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Лапландская (Vuolle)", new List<int> {2, 2, 2, 1, 2, 3}}
        }
    },
    // Категория: Африканские/Латиноамериканские
    {
        "Африканские/Латиноамериканские", new Dictionary<string, List<int>>
        {
            {"Алжирская (Algerian)", new List<int> {2, 1, 3, 1, 1, 2, 2}},
            {"Эфиопская (Ethiopian)", new List<int> {2, 2, 1, 2, 3, 2}},
            {"Африканская (Kora)", new List<int> {2, 2, 2, 1, 2, 3}},
            {"Кубинская (Cuban)", new List<int> {2, 2, 1, 2, 1, 3, 1}},
            {"Кенийская (Kenyan)", new List<int> {2, 2, 1, 2, 2, 3}},
            {"Африканская (Mbira)", new List<int> {2, 2, 2, 1, 3, 2}},
            {"Бразильская (Samba)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Карибская (Calypso)", new List<int> {2, 2, 1, 2, 2, 3}},
            {"Латино (Latin)", new List<int> {2, 2, 1, 2, 1, 2, 2}},
            {"Нигерийская (Highlife)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Мексиканская (Mariachi)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Лаосская (Lao)", new List<int> {2, 2, 2, 1, 3, 2}},
            {"Малагасийская (Malagasy)", new List<int> {2, 2, 2, 1, 2, 3}},
            {"Венесуэльская (Joropo)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Ганская (Ghanaian)", new List<int> {2, 2, 1, 2, 2, 3}},
            {"Колумбийская (Cumbia)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Танго (Tango)", new List<int> {2, 1, 2, 2, 1, 3, 1}},
            {"Филиппинская (Kundiman)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Южноафриканская (Zulu)", new List<int> {2, 2, 1, 2, 2, 3}},
            {"Перуанская (Huayno)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Кубинская (Son)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Ямайская (Mento)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Африканская (Soukous)", new List<int> {2, 2, 1, 2, 1, 2, 2}},
            {"Суданская (Nubian)", new List<int> {2, 2, 1, 2, 2, 3}},
            {"Боливийская (Saya)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Африканская (Pygmy)", new List<int> {2, 2, 2, 3, 3}},
            {"Гватемальская (Marimba)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Малийская (Griot)", new List<int> {2, 2, 2, 1, 2, 3}},
            {"Аргентинская (Chacarera)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Угандийская (Acholi)", new List<int> {2, 2, 1, 2, 2, 3}},
            {"Чилийская (Cueca)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Сенегальская (Mbalax)", new List<int> {2, 2, 1, 2, 1, 2, 2}},
            {"Эквадорская (Sanjuán)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Камерунская (Bikutsi)", new List<int> {2, 2, 2, 1, 3, 2}},
            {"Панамская (Tamborito)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Танзанийская (Taarab)", new List<int> {1, 3, 1, 2, 1, 2, 2}},
            {"Доминиканская (Merengue)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Зимбабвийская (Mbira)", new List<int> {2, 2, 2, 1, 3, 2}},
            {"Уругвайская (Candombe)", new List<int> {2, 2, 1, 2, 1, 2, 2}},
            {"Гвинейская (Kora)", new List<int> {2, 2, 2, 1, 2, 3}},
            {"Коста-Риканская (Punto)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Мозамбикская (Marrabenta)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            // Новые лады (70)
            {"Ганская (Adowa)", new List<int> {2, 2, 1, 2, 2, 3}},
            {"Аргентинская (Zamba)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Кенийская (Benga)", new List<int> {2, 2, 1, 2, 1, 2, 2}},
            {"Чилийская (Tonada)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Сенегальская (Sabar)", new List<int> {2, 2, 2, 1, 2, 3}},
            {"Эквадорская (Pasillo)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Камерунская (Makosa)", new List<int> {2, 2, 1, 2, 1, 2, 2}},
            {"Панамская (Mejorana)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Танзанийская (Ngoma)", new List<int> {2, 2, 2, 1, 3, 2}},
            {"Доминиканская (Bachata)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Зимбабвийская (Chimurenga)", new List<int> {2, 2, 1, 2, 2, 3}},
            {"Уругвайская (Milonga)", new List<int> {2, 2, 1, 2, 1, 2, 2}},
            {"Гвинейская (Balafon)", new List<int> {2, 2, 2, 1, 2, 3}},
            {"Коста-Риканская (Calypso Limón)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Мозамбикская (Timbila)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Нигерийская (Juju)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Бразильская (Forró)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Кубинская (Rumba)", new List<int> {2, 2, 1, 2, 1, 2, 2}},
            {"Ямайская (Rocksteady)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Перуанская (Marinera)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Малийская (Wassoulou)", new List<int> {2, 2, 2, 1, 2, 3}},
            {"Аргентинская (Chamame)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Кенийская (Ohangla)", new List<int> {2, 2, 1, 2, 2, 3}},
            {"Чилийская (Mapuche)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Сенегальская (Wolof)", new List<int> {2, 2, 2, 1, 2, 3}},
            {"Эквадорская (Albazo)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Камерунская (Assiko)", new List<int> {2, 2, 1, 2, 1, 2, 2}},
            {"Панамская (Cumbia Panameña)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Танзанийская (Bajuni)", new List<int> {2, 2, 2, 1, 3, 2}},
            {"Доминиканская (Palo)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Зимбабвийская (Shona Mbira)", new List<int> {2, 2, 1, 2, 2, 3}},
            {"Уругвайская (Tango Criollo)", new List<int> {2, 2, 1, 2, 1, 2, 2}},
            {"Гвинейская (Mandinka)", new List<int> {2, 2, 2, 1, 2, 3}},
            {"Коста-Риканская (Guanacaste)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Мозамбикская (Chopi)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Ганская (Ewe)", new List<int> {2, 2, 1, 2, 2, 3}},
            {"Аргентинская (Payada)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Кенийская (Luo)", new List<int> {2, 2, 1, 2, 1, 2, 2}},
            {"Чилийская (Rapa Nui)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Сенегальская (Serer)", new List<int> {2, 2, 2, 1, 2, 3}},
            {"Эквадорская (Yumbo)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Камерунская (Bamileke)", new List<int> {2, 2, 1, 2, 1, 2, 2}},
            {"Панамская (Saloma)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Танзанийская (Zaramo)", new List<int> {2, 2, 2, 1, 3, 2}},
            {"Доминиканская (Gaga)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Зимбабвийская (Ndebele)", new List<int> {2, 2, 1, 2, 2, 3}},
            {"Уругвайская (Pericón)", new List<int> {2, 2, 1, 2, 1, 2, 2}},
            {"Гвинейская (Susu)", new List<int> {2, 2, 2, 1, 2, 3}},
            {"Коста-Риканская (Siquirres)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Мозамбикская (Makua)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Нигерийская (Fuji)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Бразильская (Choro)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Кубинская (Danzón)", new List<int> {2, 2, 1, 2, 1, 2, 2}},
            {"Ямайская (Ska)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Перуанская (Festejo)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Малийская (Bambara)", new List<int> {2, 2, 2, 1, 2, 3}},
            {"Аргентинская (Carnavalito)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Кенийская (Chakacha)", new List<int> {2, 2, 1, 2, 2, 3}},
            {"Чилийская (Cueca Norteña)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Сенегальская (Tassu)", new List<int> {2, 2, 2, 1, 2, 3}},
            {"Эквадорская (Bomba)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Камерунская (Ambasse Bey)", new List<int> {2, 2, 1, 2, 1, 2, 2}},
            {"Панамская (Punto Panameño)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Танзанийская (Mdundiko)", new List<int> {2, 2, 2, 1, 3, 2}},
            {"Доминиканская (Mangulina)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Зимбабвийская (Jerusarema)", new List<int> {2, 2, 1, 2, 2, 3}},
            {"Уругвайская (Cielito)", new List<int> {2, 2, 1, 2, 1, 2, 2}},
            {"Гвинейская (Fula)", new List<int> {2, 2, 2, 1, 2, 3}},
            {"Коста-Риканская (Tambito)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Мозамбикская (Tufo)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Африканская (Mande)", new List<int> {2, 2, 1, 2, 2, 3}},
            {"Африканская (Igbo)", new List<int> {2, 2, 2, 1, 3, 2}},
            {"Африканская (Ashanti)", new List<int> {2, 2, 1, 2, 3, 2}},
            {"Африканская (San)", new List<int> {3, 2, 2, 3, 2}},
            {"Африканская (Bakongo)", new List<int> {2, 1, 2, 2, 2, 3}}
        }
    },

    // Категория: Современные/Жанровые
    {
        "Современные/Жанровые", new Dictionary<string, List<int>>
        {
            {"Транс (Trance)", new List<int> {3, 1, 2, 2, 2, 1, 1}},
            {"Пситранс (PsyTrance)", new List<int> {3, 2, 1, 2, 1, 2, 1}},
            {"Синематик (Cinematic)", new List<int> {2, 2, 1, 3, 1, 2, 1}},
            {"Эмбиент (Ambient)", new List<int> {2, 1, 2, 1, 2, 2, 2}},
            {"Драм-н-бейс (DnB)", new List<int> {2, 2, 1, 2, 1, 2, 2}},
            {"Сайоми (Saiomy)", new List<int> {3, 1, 1, 3, 1, 2, 1}},
            {"Современная (Modern Fusion)", new List<int> {2, 1, 2, 1, 2, 1, 2}},
            {"Экспериментальная (Experimental)", new List<int> {1, 2, 1, 3, 1, 2, 2}},
            {"Техно (Techno)", new List<int> {2, 1, 2, 1, 2, 2, 2}},
            {"Космическая (Space)", new List<int> {2, 2, 2, 1, 2, 1, 2}},
            {"Регги (Reggae)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Дабстеп (Dubstep)", new List<int> {3, 1, 2, 1, 2, 2, 1}},
            {"Минимализм (Minimal)", new List<int> {2, 2, 2, 2, 1, 2, 1}},
            {"Фьюжн (Fusion)", new List<int> {2, 1, 2, 1, 2, 2, 1}},
            {"Хип-хоп (Hip-Hop)", new List<int> {3, 2, 2, 1, 2, 2}},
            {"Брейкбит (Breakbeat)", new List<int> {2, 2, 1, 2, 1, 2, 2}},
            {"Глитч (Glitch)", new List<int> {1, 2, 1, 2, 2, 1, 3}},
            {"Чиллаут (Chillout)", new List<int> {2, 2, 2, 1, 2, 2, 1}},
            {"Нью-эйдж (New Age)", new List<int> {2, 2, 2, 2, 1, 2, 1}},
            {"Рок (Rock)", new List<int> {3, 2, 2, 3, 2}},
            {"Диско (Disco)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Электро (Electro)", new List<int> {2, 1, 2, 1, 2, 2, 2}},
            {"Индастриал (Industrial)", new List<int> {1, 2, 2, 1, 2, 2, 2}},
            {"Даунтемпо (Downtempo)", new List<int> {2, 2, 2, 1, 2, 2, 1}},
            {"Эпик (Epic)", new List<int> {2, 2, 1, 3, 1, 2, 1}},
            {"Кантри (Country)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Ска (Ska)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Трип-хоп (Trip-Hop)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Гранж (Grunge)", new List<int> {3, 2, 2, 3, 2}},
            {"Дарк-эмбиент (Dark Ambient)", new List<int> {1, 2, 2, 1, 2, 2, 2}},
            {"Симфонический (Symphonic)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Поп (Pop)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Соул (Soul)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Фанк (Funk)", new List<int> {2, 2, 1, 2, 1, 2, 2}},
            {"Хаус (House)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Дрилл (Drill)", new List<int> {3, 2, 2, 1, 2, 2}},
            {"Трап (Trap)", new List<int> {3, 2, 2, 3, 2}},
            {"Ретро (Retro)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Этно-фьюжн (Ethno Fusion)", new List<int> {2, 1, 3, 1, 2, 2, 1}},
            {"Авангард (Avant-Garde)", new List<int> {1, 2, 1, 3, 1, 2, 2}},
            {"Барокко (Baroque)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Классический рок (Classic Rock)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Прогрессив (Progressive)", new List<int> {2, 1, 2, 1, 2, 2, 2}},
            {"Метал (Metal)", new List<int> {3, 2, 2, 3, 2}},
            {"Дрим-поп (Dream Pop)", new List<int> {2, 2, 2, 1, 2, 2, 1}},
            {"Лоу-фай (Lo-Fi)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Нойз (Noise)", new List<int> {1, 2, 1, 2, 2, 1, 3}},
            {"Рагга (Ragga)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Госпел (Gospel)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Этно-джаз (Ethno Jazz)", new List<int> {2, 1, 2, 2, 1, 1, 2}},
            {"Синтвейв (Synthwave)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"R&B (R&B)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Блюз-рок (Blues Rock)", new List<int> {3, 2, 1, 1, 3, 2}},
            {"Альтернатива (Alternative)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Панк (Punk)", new List<int> {3, 2, 2, 3, 2}},
            {"Эмбиент-джаз (Ambient Jazz)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Хард-рок (Hard Rock)", new List<int> {3, 2, 2, 3, 2}},
            {"Джангл (Jungle)", new List<int> {2, 2, 1, 2, 1, 2, 2}},
            {"Гараж (Garage)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Шугейз (Shoegaze)", new List<int> {2, 2, 2, 1, 2, 2, 1}},
            {"Даб (Dub)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Этно-эмбиент (Ethno Ambient)", new List<int> {2, 1, 2, 1, 2, 2, 2}},
            {"Техно-эмбиент (Techno Ambient)", new List<int> {2, 2, 2, 1, 2, 2, 1}},
            {"Нью-скул (New School)", new List<int> {3, 2, 2, 1, 2, 2}},
            {"Прогрессив-хаус (Progressive House)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Нью-джаз (Nu Jazz)", new List<int> {2, 1, 2, 2, 1, 1, 2}},
            {"Бразильский фонк (Brazilian Phonk)", new List<int> {3, 2, 2, 1, 2, 2}},
            {"Гиперпоп (Hyperpop)", new List<int> {2, 1, 2, 1, 2, 1, 3}},
            {"Вейпорвейв (Vaporwave)", new List<int> {2, 2, 2, 1, 2, 2, 1}},
            {"Чиллстеп (Chillstep)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Фьюжн-рок (Fusion Rock)", new List<int> {2, 1, 2, 1, 2, 2, 2}},
            {"Техно-поп (Techno Pop)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Этно-рок (Ethno Rock)", new List<int> {2, 1, 3, 1, 2, 2, 1}},
            {"Нью-метал (Nu Metal)", new List<int> {3, 2, 2, 3, 2}},
            {"Дарквейв (Darkwave)", new List<int> {1, 2, 2, 1, 2, 2, 2}},
            {"Синти-поп (Synth Pop)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Этно-даб (Ethno Dub)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Техно-фанк (Techno Funk)", new List<int> {2, 2, 1, 2, 1, 2, 2}},
            {"Глитч-хоп (Glitch Hop)", new List<int> {2, 1, 2, 1, 2, 2, 2}},
            {"Прогрессив-метал (Progressive Metal)", new List<int> {3, 2, 1, 2, 2, 2}},
            {"Чилл-хаус (Chill House)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Этно-транс (Ethno Trance)", new List<int> {3, 1, 2, 2, 1, 2, 1}},
            {"Нью-кантри (New Country)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Дарк-джаз (Dark Jazz)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Фонк (Phonk)", new List<int> {3, 2, 2, 1, 2, 2}},
            {"Этно-поп (Ethno Pop)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Техно-дабстеп (Techno Dubstep)", new List<int> {3, 1, 2, 1, 2, 2, 1}},
            {"Синти-фанк (Synth Funk)", new List<int> {2, 2, 1, 2, 1, 2, 2}},
            {"Глитч-рок (Glitch Rock)", new List<int> {2, 1, 2, 1, 2, 2, 2}},
            {"Прогрессив-фанк (Progressive Funk)", new List<int> {2, 2, 1, 2, 1, 2, 2}},
            {"Дрим-рок (Dream Rock)", new List<int> {2, 2, 2, 1, 2, 2, 1}},
            {"Нью-фолк (New Folk)", new List<int> {2, 1, 2, 2, 2, 1, 2}},
            {"Этно-драм (Ethno Drum)", new List<int> {2, 2, 1, 2, 1, 2, 2}},
            {"Техно-регги (Techno Reggae)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Чилл-фонк (Chill Phonk)", new List<int> {3, 2, 2, 1, 2, 2}},
            // Новые лады (70)
            {"Дарк-хаус (Dark House)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Нью-диско (New Disco)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Этно-техно (Ethno Techno)", new List<int> {2, 1, 2, 1, 2, 2, 2}},
            {"Прогрессив-джаз (Progressive Jazz)", new List<int> {2, 1, 2, 2, 1, 1, 2}},
            {"Синти-рок (Synth Rock)", new List<int> {3, 2, 2, 3, 2}},
            {"Глитч-фанк (Glitch Funk)", new List<int> {2, 2, 1, 2, 1, 2, 2}},
            {"Чилл-даб (Chill Dub)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Техно-фьюжн (Techno Fusion)", new List<int> {2, 1, 2, 1, 2, 2, 2}},
            {"Нью-регги (New Reggae)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Этно-трип (Ethno Trip)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Дрим-хаус (Dream House)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Прогрессив-рок (Progressive Rock)", new List<int> {2, 1, 2, 1, 2, 2, 2}},
            {"Синти-джаз (Synth Jazz)", new List<int> {2, 1, 2, 2, 1, 1, 2}},
            {"Глитч-дабстеп (Glitch Dubstep)", new List<int> {3, 1, 2, 1, 2, 2, 1}},
            {"Чилл-рок (Chill Rock)", new List<int> {2, 2, 2, 1, 2, 2, 1}},
            {"Этно-даунтемпо (Ethno Downtempo)", new List<int> {2, 2, 2, 1, 2, 2, 1}},
            {"Техно-трип (Techno Trip)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Нью-блюз (New Blues)", new List<int> {3, 2, 1, 1, 3, 2}},
            {"Дрим-фанк (Dream Funk)", new List<int> {2, 2, 1, 2, 1, 2, 2}},
            {"Прогрессив-даб (Progressive Dub)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Синти-эмбиент (Synth Ambient)", new List<int> {2, 1, 2, 1, 2, 2, 2}},
            {"Глитч-джаз (Glitch Jazz)", new List<int> {2, 1, 2, 2, 1, 1, 2}},
            {"Чилл-регги (Chill Reggae)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Этно-глиц (Ethno Glitch)", new List<int> {1, 2, 1, 2, 2, 1, 3}},
            {"Техно-рок (Techno Rock)", new List<int> {3, 2, 2, 3, 2}},
            {"Нью-поп (New Pop)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Дрим-даб (Dream Dub)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Прогрессив-эмбиент (Progressive Ambient)", new List<int> {2, 1, 2, 1, 2, 2, 2}},
            {"Синти-дабстеп (Synth Dubstep)", new List<int> {3, 1, 2, 1, 2, 2, 1}},
            {"Глитч-регги (Glitch Reggae)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Чилл-джаз (Chill Jazz)", new List<int> {2, 1, 2, 2, 1, 1, 2}},
            {"Этно-фанк (Ethno Funk)", new List<int> {2, 2, 1, 2, 1, 2, 2}},
            {"Техно-даунтемпо (Techno Downtempo)", new List<int> {2, 2, 2, 1, 2, 2, 1}},
            {"Нью-рок (New Rock)", new List<int> {3, 2, 2, 3, 2}},
            {"Дрим-трип (Dream Trip)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Прогрессив-регги (Progressive Reggae)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Синти-трип (Synth Trip)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Глитч-эмбиент (Glitch Ambient)", new List<int> {1, 2, 1, 2, 2, 1, 3}},
            {"Чилл-фьюжн (Chill Fusion)", new List<int> {2, 1, 2, 1, 2, 2, 2}},
            {"Этно-джангл (Ethno Jungle)", new List<int> {2, 2, 1, 2, 1, 2, 2}},
            {"Техно-джаз (Techno Jazz)", new List<int> {2, 1, 2, 2, 1, 1, 2}},
            {"Нью-даб (New Dub)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Дрим-джаз (Dream Jazz)", new List<int> {2, 1, 2, 2, 1, 1, 2}},
            {"Прогрессив-фолк (Progressive Folk)", new List<int> {2, 1, 2, 2, 2, 1, 2}},
            {"Синти-фолк (Synth Folk)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Глитч-трип (Glitch Trip)", new List<int> {1, 2, 1, 2, 2, 1, 3}},
            {"Чилл-эмбиент (Chill Ambient)", new List<int> {2, 1, 2, 1, 2, 2, 2}},
            {"Этно-хаус (Ethno House)", new List<int> {2, 2, 1, 2, 2, 1, 2}},
            {"Техно-фолк (Techno Folk)", new List<int> {2, 1, 2, 2, 2, 1, 2}},
            {"Нью-трип (New Trip)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Дрим-фолк (Dream Folk)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Прогрессив-даунтемпо (Progressive Downtempo)", new List<int> {2, 2, 2, 1, 2, 2, 1}},
            {"Синти-даунтемпо (Synth Downtempo)", new List<int> {2, 2, 2, 1, 2, 2, 1}},
            {"Глитч-фолк (Glitch Folk)", new List<int> {1, 2, 1, 2, 2, 1, 3}},
            {"Чилл-трип (Chill Trip)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Этно-дабстеп (Ethno Dubstep)", new List<int> {3, 1, 2, 1, 2, 2, 1}},
            {"Техно-трип-хоп (Techno Trip-Hop)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Нью-фанк (New Funk)", new List<int> {2, 2, 1, 2, 1, 2, 2}},
            {"Дрим-даунтемпо (Dream Downtempo)", new List<int> {2, 2, 2, 1, 2, 2, 1}},
            {"Прогрессив-джангл (Progressive Jungle)", new List<int> {2, 2, 1, 2, 1, 2, 2}},
            {"Синти-регги (Synth Reggae)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Глитч-даунтемпо (Glitch Downtempo)", new List<int> {1, 2, 1, 2, 2, 1, 3}},
            {"Чилл-дабстеп (Chill Dubstep)", new List<int> {3, 1, 2, 1, 2, 2, 1}},
            {"Этно-фолк (Ethno Folk)", new List<int> {2, 1, 2, 2, 2, 1, 2}},
            {"Техно-даб (Techno Dub)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Нью-джангл (New Jungle)", new List<int> {2, 2, 1, 2, 1, 2, 2}},
            {"Дрим-регги (Dream Reggae)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Прогрессив-трип (Progressive Trip)", new List<int> {2, 1, 2, 2, 1, 2, 2}},
            {"Синти-даб (Synth Dub)", new List<int> {2, 2, 1, 2, 2, 2, 1}},
            {"Глитч-джангл (Glitch Jungle)", new List<int> {2, 2, 1, 2, 1, 2, 2}},
            {"Чилл-фолк (Chill Folk)", new List<int> {2, 1, 2, 2, 2, 1, 2}},
            {"Космический минор (Cosmic Minor)", new List<int> {2, 1, 3, 1, 2, 2, 1}},
            {"Глитч-тон (Glitch Tone)", new List<int> {1, 3, 1, 2, 1, 2, 2}},
            {"Дримвейв (Dreamwave)", new List<int> {2, 2, 2, 1, 2, 2, 1}},
            {"Нойз-кор (Noise Core)", new List<int> {1, 2, 1, 2, 1, 3, 2}},
            {"Техно-микс (Techno Mix)", new List<int> {2, 1, 2, 1, 3, 2, 1}}
        }

    },
    {
    "Микротональные лады", new Dictionary<string, List<int>>
    {
        {"Бохлен-Пирс (Bohlen-Pierce)", new List<int> {3, 2, 3, 2, 2}},
        {"Гамма 19-ET (19-Tone Equal Temperament)", new List<int> {2, 1, 2, 1, 2, 2, 2}},
        {"Квартальный лад (Quarter-Tone)", new List<int> {1, 2, 1, 3, 1, 2, 2}}
    }
},
            };


            foreach (var category in bigScalePatterns)
            {
                var scales = new Dictionary<string, int[]>();
                foreach (var scale in category.Value)
                {
                    scales[scale.Key] = ConvertToAbsoluteIntervals(scale.Value);
                }
                result[category.Key] = scales;
            }

            return result;
        }

        private static int[] ConvertToAbsoluteIntervals(List<int> cumulativeIntervals)
        {
            var absolute = new List<int> { 0 };
            for (int i = 0; i < cumulativeIntervals.Count; i++)
            {
                absolute.Add(absolute[i] + cumulativeIntervals[i]);
            }
            return absolute.ToArray();
        }

        private void InitializeTonicaComboBox()
        {
            cmbBoxTonica.Items.AddRange(new string[]
            {
                "C", "C#", "D", "D#", "E", "F", "F#", "G", "G#", "A", "A#", "B",
                "Cm", "C#m", "Dm", "D#m", "Em", "Fm", "F#m", "Gm", "G#m", "Am", "A#m", "Bm"
            });
            cmbBoxTonica.SelectedIndex = 0;
        }

        private void InitializeCategoryComboBox()
        {
            cmbBoxCategory.Items.AddRange(scalesByCategory.Keys.OrderBy(c => c).ToArray());
            if (cmbBoxCategory.Items.Count > 0)
                cmbBoxCategory.SelectedIndex = 0;
        }

        private void InitializeScaleComboBox()
        {
            // Изначально заполняем первый раз после выбора категории
            UpdateScaleComboBox();
        }

        private void UpdateScaleComboBox()
        {
            cmbBoxScale.Items.Clear();
            string selectedCategory = cmbBoxCategory.SelectedItem?.ToString();

            if (!string.IsNullOrEmpty(selectedCategory) && scalesByCategory.TryGetValue(selectedCategory, out var scales))
            {
                cmbBoxScale.Items.AddRange(scales.Keys.OrderBy(s => s).ToArray());
            }

            if (cmbBoxScale.Items.Count > 0)
                cmbBoxScale.SelectedIndex = 0;
        }

        private void CmbBoxCategory_SelectedIndexChanged(object sender, EventArgs e)
        {
            UpdateScaleComboBox();
        }

        private void InitializePlayButton()
        {
            btnPlayMidi.Click += BtnPlayMidi_Click;
            btnPlayMidi.Enabled = false;
        }

        // Метод для проверки, принадлежит ли нота выбранному ладу
        private bool IsNoteInScale(int midiNote, List<int> scaleNotes)
        {
            // Приводим ноту к основной октаве для сравнения
            int normalizedNote = midiNote % 12;

            // Проверяем, есть ли эта нота (с учетом октавы) в списке нот гаммы
            return scaleNotes.Any(n => n % 12 == normalizedNote);
        }

        // Метод для поиска ближайшей ноты из гаммы
        private int FindClosestNoteInScale(int targetNote, List<int> scaleNotes)
        {
            if (scaleNotes.Count == 0)
                return -1;

            // Строгая проверка - если нота уже в гамме, возвращаем её
            if (scaleNotes.Contains(targetNote))
                return targetNote;

            // Поиск ближайшей ноты с учетом тональности
            int closestNote = scaleNotes[0];
            int minDistance = Math.Abs(targetNote - closestNote);

            foreach (int note in scaleNotes)
            {
                int distance = Math.Abs(targetNote - note);
                if (distance < minDistance)
                {
                    minDistance = distance;
                    closestNote = note;
                }
                else if (distance == minDistance && Math.Abs(note - 60) < Math.Abs(closestNote - 60))
                {
                    // При равном расстоянии предпочитаем ноту ближе к центральному До (C4)
                    closestNote = note;
                }
            }

            // Дополнительная проверка класса высоты - убедимся, что нота в той же октаве
            int targetOctave = targetNote / 12;
            int closestOctave = closestNote / 12;

            // Если октавы сильно отличаются, пробуем найти ноту в той же октаве
            if (Math.Abs(targetOctave - closestOctave) > 1)
            {
                int targetPitch = targetNote % 12;
                // Ищем ноту того же класса высоты в гамме, но в правильной октаве
                var sameClassNotes = scaleNotes.Where(n => n % 12 == closestNote % 12 &&
                                                        Math.Abs(n / 12 - targetOctave) <= 1).ToList();
                if (sameClassNotes.Count > 0)
                {
                    // Берем ближайшую к целевой октаве
                    closestNote = sameClassNotes.OrderBy(n => Math.Abs(n / 12 - targetOctave)).First();
                }
            }

            return closestNote;
        }

        private List<int> StrictGetNotesFromScale(string rootNote, string chordType, int octave, List<int> scaleNotes)
        {
            // Получаем базовую ноту
            if (!noteOffsets.TryGetValue(rootNote, out int rootOffset))
            {
                rootOffset = 0; // По умолчанию C
            }

            // Получаем интервалы аккорда
            if (!chordTypes.TryGetValue(chordType, out int[] chordIntervals))
            {
                chordIntervals = chordTypes["Major"]; // По умолчанию мажорное трезвучие
            }

            // Корневая нота в выбранной октаве
            int baseNote = octave * 12 + rootOffset;

            // Результирующий список нот
            List<int> resultNotes = new List<int>();

            // Сначала добавляем корневую ноту, если она есть в гамме
            int rootNoteInScale = FindStrictNoteInScale(baseNote, scaleNotes);
            if (rootNoteInScale != -1) resultNotes.Add(rootNoteInScale);

            // Затем добавляем другие ноты аккорда из гаммы
            foreach (int interval in chordIntervals)
            {
                int noteToAdd = baseNote + interval;

                // Ищем строго ноту в гамме
                int noteInScale = FindStrictNoteInScale(noteToAdd, scaleNotes);

                if (noteInScale != -1 && !resultNotes.Contains(noteInScale))
                {
                    resultNotes.Add(noteInScale);
                }
            }

            // Если получилось мало нот, добавляем ноты из гаммы
            while (resultNotes.Count < 3)
            {
                // Кандидаты из гаммы, которые еще не добавлены
                var candidates = scaleNotes.Where(n => !resultNotes.Contains(n) &&
                                                 n >= baseNote && n < baseNote + 12).ToList();

                if (candidates.Count == 0) break; // Если нет подходящих кандидатов

                resultNotes.Add(candidates[random.Next(candidates.Count)]);
            }

            return resultNotes;
        }
        private int FindStrictNoteInScale(int noteToFind, List<int> scaleNotes)
        {
            // Сначала ищем точное совпадение
            if (scaleNotes.Contains(noteToFind))
                return noteToFind;

            // Ищем ноту того же класса высоты в соседних октавах
            int noteClass = noteToFind % 12;
            var candidateNotes = scaleNotes.Where(n => n % 12 == noteClass).OrderBy(n => Math.Abs(n - noteToFind)).ToList();

            if (candidateNotes.Count > 0)
                return candidateNotes[0];

            return -1; // Нота не найдена
        }

        // Метод для генерации арпеджио из аккорда с учетом лада
        private List<int> GenerateArpeggioFromChord(string rootNote, string chordType, int octave, int arpNotesCount, List<int> scaleNotes)
        {
            // Получаем базовую ноту
            if (!noteOffsets.TryGetValue(rootNote, out int rootOffset))
            {
                rootOffset = 0; // По умолчанию C
            }

            // Получаем интервалы аккорда
            if (!chordTypes.TryGetValue(chordType, out int[] chordIntervals))
            {
                // По умолчанию используем мажорное трезвучие
                chordIntervals = chordTypes["Major"];
            }

            // Создаем базовый аккорд
            List<int> chordNotes = new List<int>();
            int baseNote = octave * 12 + rootOffset;

            // Добавляем только те ноты аккорда, которые входят в гамму
            foreach (int interval in chordIntervals)
            {
                int note = baseNote + interval;
                if (IsNoteInScale(note, scaleNotes))
                {
                    chordNotes.Add(note);
                }
                else
                {
                    // Если нота не входит в гамму, ищем ближайшую ноту из гаммы
                    int closest = FindClosestNoteInScale(note, scaleNotes);
                    if (closest != -1)
                    {
                        chordNotes.Add(closest);
                    }
                }
            }

            // Если получилось мало нот (например, если некоторые не вошли в гамму),
            // добавляем ноты из гаммы, чтобы достичь нужного количества
            while (chordNotes.Count < arpNotesCount)
            {
                // Находим ноты из гаммы, которые еще не добавлены
                var availableScaleNotes = scaleNotes.Where(n => !chordNotes.Contains(n) && n >= 60 && n <= 83).ToList();

                if (availableScaleNotes.Count > 0)
                {
                    // Добавляем случайную ноту из гаммы
                    chordNotes.Add(availableScaleNotes[random.Next(availableScaleNotes.Count)]);
                }
                else
                {
                    // Если все ноты гаммы уже добавлены, добавляем случайную ноту из гаммы в следующей октаве
                    var notesInRange = scaleNotes.Where(n => n >= 60 && n <= 83).ToList();
                    if (notesInRange.Count > 0)
                    {
                        int randomScaleNote = notesInRange[random.Next(notesInRange.Count)];
                        chordNotes.Add(randomScaleNote);
                    }
                    else
                    {
                        // Если вообще нет нот в диапазоне, добавляем ноту C4
                        chordNotes.Add(60);
                    }
                }
            }

            // Если требуется меньше нот, чем получилось, обрезаем список
            if (chordNotes.Count > arpNotesCount)
            {
                chordNotes = chordNotes.Take(arpNotesCount).ToList();
            }

            // Случайное изменение порядка нот для разнообразия
            if (random.NextDouble() > 0.5)
            {
                chordNotes = chordNotes.OrderBy(x => random.Next()).ToList();
            }

            return chordNotes;
        }

        // Метод для создания вариаций, учитывающих гамму
        private List<int> MakeSimilarButNotIdentical(List<int> motif, List<int> scaleNotes)
        {
            List<int> result = new List<int>(motif);

            // Выбираем тип вариации - больше вариантов
            int variationType = random.Next(7); // Увеличиваем количество типов вариаций

            switch (variationType)
            {
                case 0: // Смена интервальных отношений
                    for (int i = 0; i < result.Count; i++)
                    {
                        if (random.NextDouble() < 0.6) // Увеличиваем вероятность изменения
                        {
                            int currentNote = result[i];
                            if (currentNote > 0) // Если не пауза
                            {
                                // Ищем ноты на разных интервалах от текущей, но только в гамме
                                var validIntervals = new[] { 2, 3, 4, 5, 7, 9 }; // Добавляем больше интервалов
                                int interval = validIntervals[random.Next(validIntervals.Length)];

                                // Случайно вверх или вниз
                                int direction = (random.NextDouble() < 0.5) ? 1 : -1;
                                int targetNote = currentNote + (interval * direction);

                                // Проверяем, что нота в гамме и в разумном диапазоне
                                if (scaleNotes.Contains(targetNote) && targetNote >= 60 && targetNote <= 83)
                                {
                                    result[i] = targetNote;
                                }
                                else
                                {
                                    // Если нота не в гамме, ищем ближайшую
                                    int closest = FindClosestNoteInScale(targetNote, scaleNotes);
                                    if (closest != -1)
                                        result[i] = closest;
                                }
                            }
                        }
                    }
                    break;

                case 1: // Орнаментация мелодии
                    if (result.Count > 3)
                    {
                        // Увеличиваем количество позиций для орнаментации
                        int ornamentPositions = Math.Min(2, result.Count / 2);

                        for (int ornament = 0; ornament < ornamentPositions; ornament++)
                        {
                            int idx = random.Next(result.Count - 2);
                            int currentNote = result[idx];

                            if (currentNote > 0) // Если не пауза
                            {
                                // Находим ноты в гамме выше и ниже текущей
                                var higherNotes = scaleNotes.Where(n => n > currentNote && n <= currentNote + 7).ToList();
                                var lowerNotes = scaleNotes.Where(n => n < currentNote && n >= currentNote - 7).ToList();

                                if (higherNotes.Count > 0 && lowerNotes.Count > 0)
                                {
                                    // Создаем трель или форшлаг
                                    int higherNote = higherNotes.OrderBy(n => n).First();
                                    int lowerNote = lowerNotes.OrderByDescending(n => n).First();

                                    // Разные типы орнаментации
                                    double ornamentType = random.NextDouble();

                                    if (ornamentType < 0.33)
                                    {
                                        // Трель вверх-вниз
                                        result[idx] = higherNote;
                                        result[idx + 1] = currentNote;
                                        if (idx + 2 < result.Count)
                                            result[idx + 2] = lowerNote;
                                    }
                                    else if (ornamentType < 0.66)
                                    {
                                        // Форшлаг
                                        result[idx] = lowerNote;
                                        result[idx + 1] = currentNote;
                                    }
                                    else
                                    {
                                        // Группетто (оборот)
                                        result[idx] = currentNote;
                                        if (idx + 1 < result.Count)
                                            result[idx + 1] = higherNote;
                                        if (idx + 2 < result.Count)
                                            result[idx + 2] = currentNote;
                                        if (idx + 3 < result.Count)
                                            result[idx + 3] = lowerNote;
                                    }
                                }
                            }
                        }
                    }
                    break;

                case 2: // Ритмический сдвиг/ротация
                    if (result.Count > 1)
                    {
                        int rotateBy = random.Next(1, result.Count);
                        List<int> temp = new List<int>(result);

                        for (int i = 0; i < result.Count; i++)
                        {
                            result[i] = temp[(i + rotateBy) % temp.Count];
                        }
                    }
                    break;

                case 3: // Зеркальное отражение + вариация
                    result.Reverse();

                    // Добавляем небольшие изменения после отражения
                    for (int i = 0; i < result.Count; i++)
                    {
                        if (random.NextDouble() < 0.3 && result[i] > 0) // Увеличиваем с 0.2 до 0.3
                        {
                            var neighborNotes = scaleNotes.Where(n => Math.Abs(n - result[i]) <= 4 && n != result[i]).ToList();
                            if (neighborNotes.Count > 0)
                            {
                                result[i] = neighborNotes[random.Next(neighborNotes.Count)];
                            }
                        }
                    }
                    break;

                case 4: // Смена регистра с вариациями
                    for (int i = 0; i < result.Count; i++)
                    {
                        if (result[i] > 0) // Если не пауза
                        {
                            double chance = random.NextDouble();
                            if (chance < 0.4 && result[i] >= 60 && result[i] <= 72) // Увеличиваем с 0.3 до 0.4
                            {
                                // Подъем на октаву
                                int octaveUp = result[i] + 12;
                                // Проверяем, что нота в гамме
                                if (scaleNotes.Contains(octaveUp))
                                    result[i] = octaveUp;
                            }
                            else if (chance < 0.7 && result[i] >= 72) // Увеличиваем с 0.6 до 0.7
                            {
                                // Спуск на октаву
                                int octaveDown = result[i] - 12;
                                // Проверяем, что нота в гамме
                                if (scaleNotes.Contains(octaveDown))
                                    result[i] = octaveDown;
                            }
                        }
                    }
                    break;

                case 5: // Создание новой мелодической линии, сохраняющей контур
                    if (result.Count > 1)
                    {
                        // Определяем направление движения мелодии
                        List<int> directions = new List<int>();
                        for (int i = 1; i < result.Count; i++)
                        {
                            if (result[i] > 0 && result[i - 1] > 0) // Если не паузы
                            {
                                int direction = Math.Sign(result[i] - result[i - 1]);
                                directions.Add(direction);
                            }
                            else
                            {
                                directions.Add(0); // Нет направления для пауз
                            }
                        }

                        // Создаем новую мелодию с тем же контуром, но другими нотами
                        int startNote = result[0];
                        for (int i = 1; i < result.Count; i++)
                        {
                            if (result[i] > 0) // Если не пауза
                            {
                                int direction = (i - 1 < directions.Count) ? directions[i - 1] : 0;

                                // Увеличиваем диапазон движения для большего разнообразия
                                int minStep = 2; // Минимальный шаг
                                int maxStep = 7; // Максимальный шаг

                                if (direction != 0)
                                {
                                    int step = minStep + random.Next(maxStep - minStep + 1);
                                    int targetNote = result[i - 1] + (step * direction);

                                    // Проверяем, что нота в гамме
                                    int closest = FindClosestNoteInScale(targetNote, scaleNotes);
                                    if (closest != -1)
                                        result[i] = closest;
                                }
                            }
                        }
                    }
                    break;

                case 6: // Ритмическое разнообразие - добавление пауз и акцентов
                    for (int i = 0; i < result.Count; i++)
                    {
                        double chance = random.NextDouble();

                        if (chance < 0.15 && i > 0 && i < result.Count - 1) // 15% шанс паузы (не первая и не последняя нота)
                        {
                            result[i] = 0; // Пауза
                        }
                        else if (chance < 0.40 && result[i] > 0) // Увеличиваем с 0.35 до 0.40
                        {
                            // Акцентируем ноту другой из гаммы
                            var accentNotes = scaleNotes.Where(n =>
                                n != result[i] &&
                                Math.Abs(n - result[i]) >= 2 && // Минимальная разница
                                Math.Abs(n - result[i]) <= 7 && // Максимальная разница
                                n >= 60 && n <= 83).ToList();

                            if (accentNotes.Count > 0)
                            {
                                result[i] = accentNotes[random.Next(accentNotes.Count)];
                            }
                        }
                    }
                    break;
            }

            // Финальная проверка на соответствие гамме
            for (int i = 0; i < result.Count; i++)
            {
                if (result[i] > 0 && !scaleNotes.Contains(result[i]))
                {
                    int closest = FindClosestNoteInScale(result[i], scaleNotes);
                    result[i] = (closest != -1) ? closest : scaleNotes[random.Next(scaleNotes.Count)];
                }
            }

            // Финальная проверка на повторы
            for (int i = 1; i < result.Count; i++)
            {
                // Если текущая нота равна предыдущей и это не паузы
                if (result[i] > 0 && result[i] == result[i - 1] && random.NextDouble() < 0.7)
                {
                    // Находим другую ноту в гамме
                    var alternativeNotes = scaleNotes.Where(n =>
                        n != result[i] &&
                        Math.Abs(n - result[i]) <= 7 && // Ограничиваем диапазон для большей мелодичности
                        n >= 60 && n <= 83).ToList();

                    if (alternativeNotes.Count > 0)
                    {
                        result[i] = alternativeNotes[random.Next(alternativeNotes.Count)];
                    }
                }
            }

            return result;
        }

        private int ChooseRandomChordInstrument()
        {
            // Выбор инструмента для аккомпанемента
            int[] chordInstruments = {
        0,   // Acoustic Grand Piano
        4,   // Electric Piano 1
        25,  // Acoustic Guitar (steel)
        48,  // String Ensemble 1
        35,  // Electric Bass (finger)
        45,  // Pizzicato Strings
        91,  // Pad 3 (polysynth)
        95   // Pad 7 (halo)
    };

            return chordInstruments[random.Next(chordInstruments.Length)];
        }
        private int ChooseRandomMelodyInstrument()
        {
            // Выбор инструмента для мелодии
            int[] melodyInstruments = {
        0,   // Acoustic Grand Piano
        4,   // Electric Piano 1
        24,  // Acoustic Guitar (nylon)
        40,  // Violin
        56,  // Trumpet
        73,  // Flute
        80,  // Lead 1 (square)
        81,  // Lead 2 (sawtooth)
        89,  // Pad 1 (new age)
        65,  // Soprano Sax
        68   // Oboe
    };

            return melodyInstruments[random.Next(melodyInstruments.Length)];
        }

        // Метод для генерации последовательности аккордов, подходящих для выбранной гаммы
        private List<KeyValuePair<string, string>> GenerateChordProgression(string tonica, string category, string scale, int count, List<int> scaleNotes)
        {
            bool isMinor = tonica.EndsWith("m");
            string root = isMinor ? tonica.Substring(0, tonica.Length - 1) : tonica;

            // Получаем аккорды, подходящие к гамме
            List<string> compatibleChordTypes = GetCompatibleChordTypes(category, scale, isMinor, scaleNotes);

            List<KeyValuePair<string, string>> progression = new List<KeyValuePair<string, string>>();

            // Начинаем с тоники - важно для правильной тональности
            progression.Add(new KeyValuePair<string, string>(root, isMinor ? "Minor" : "Major"));

            // ВАЖНО: Гарантируем, что последний аккорд тоже будет тоникой
            if (count > 1)
            {
                // Генерируем промежуточные аккорды
                for (int i = 1; i < count - 1; i++)
                {
                    // Для более музыкального звучания, выбираем аккорды с учетом предыдущего
                    string prevRoot = progression[i - 1].Key;
                    string prevType = progression[i - 1].Value;

                    // Находим ступени, хорошо сочетающиеся с предыдущим аккордом
                    List<int> goodSteps = GetGoodSteps(prevRoot, prevType, isMinor);

                    int step = goodSteps[random.Next(goodSteps.Count)];
                    int newRootOffset = (noteOffsets[prevRoot] + step) % 12;
                    string newRoot = noteOffsets.FirstOrDefault(x => x.Value == newRootOffset).Key;

                    // Если мы не нашли точное соответствие из-за энгармонизма, используем первый вариант
                    if (string.IsNullOrEmpty(newRoot))
                    {
                        // Получаем все названия нот для данного смещения
                        var possibleNames = noteOffsets.Where(x => x.Value == newRootOffset).Select(x => x.Key).ToList();
                        if (possibleNames.Count > 0)
                        {
                            newRoot = possibleNames[0];
                        }
                        else
                        {
                            // Если совсем ничего не найдено, используем тонику
                            newRoot = root;
                        }
                    }

                    // Выбираем тип аккорда из совместимых
                    string chordType = compatibleChordTypes[random.Next(compatibleChordTypes.Count)];

                    progression.Add(new KeyValuePair<string, string>(newRoot, chordType));
                }

                // Последний аккорд - тоника, для музыкального завершения
                progression.Add(new KeyValuePair<string, string>(root, isMinor ? "Minor" : "Major"));
            }

            return progression;
        }
        // Метод для получения типов аккордов, совместимых с выбранной гаммой
        private List<string> GetCompatibleChordTypes(string category, string scale, bool isMinor, List<int> scaleNotes)
        {
            // Базовые типы аккордов
            List<string> result = new List<string> { "Major", "Minor", "Major7", "Minor7", "Dominant7" };

            // Фильтруем типы аккордов, проверяя, что их ноты входят в гамму
            List<string> filteredTypes = new List<string>();

            foreach (var chordType in chordTypes.Keys)
            {
                // Для проверки используем базовую ноту тоники
                string rootNote = isMinor ? "A" : "C"; // Используем A для минора и C для мажора как базовые
                int rootMidi = isMinor ? 9 : 0; // MIDI номер для A или C

                // Получаем ноты аккорда
                int[] intervals = chordTypes[chordType];
                bool allNotesInScale = true;

                foreach (int interval in intervals)
                {
                    int noteMidi = (rootMidi + interval) % 12; // Приводим к одной октаве
                    if (!scaleNotes.Any(n => n % 12 == noteMidi))
                    {
                        allNotesInScale = false;
                        break;
                    }
                }

                if (allNotesInScale)
                {
                    filteredTypes.Add(chordType);
                }
            }

            // Если после фильтрации остались типы, используем их
            if (filteredTypes.Count > 0)
            {
                result = filteredTypes;
            }

            // Добавляем дополнительные типы в зависимости от гаммы
            if (scale.Contains("Major") || scale.Contains("Ionian"))
            {
                AddIfCompatible(result, new[] { "Major9", "Major13", "6", "Add9", "Quartal" }, scaleNotes, isMinor);
            }
            else if (scale.Contains("Minor") || scale.Contains("Aeolian"))
            {
                AddIfCompatible(result, new[] { "Minor9", "Minor11", "m6", "Half-Diminished7", "Diminished" }, scaleNotes, isMinor);
            }
            else if (scale.Contains("Dorian"))
            {
                AddIfCompatible(result, new[] { "Minor9", "Minor13", "m6", "Dominant9", "So What" }, scaleNotes, isMinor);
            }
            // Другие условия для разных ладов...

            return result;
        }

        // Вспомогательный метод для добавления совместимых типов аккордов
        private void AddIfCompatible(List<string> resultList, string[] typesToAdd, List<int> scaleNotes, bool isMinor)
        {
            string rootNote = isMinor ? "A" : "C";
            int rootMidi = isMinor ? 9 : 0;

            foreach (var type in typesToAdd)
            {
                if (!chordTypes.ContainsKey(type))
                    continue;

                int[] intervals = chordTypes[type];
                bool allNotesInScale = true;

                foreach (int interval in intervals)
                {
                    int noteMidi = (rootMidi + interval) % 12;
                    if (!scaleNotes.Any(n => n % 12 == noteMidi))
                    {
                        allNotesInScale = false;
                        break;
                    }
                }

                if (allNotesInScale && !resultList.Contains(type))
                {
                    resultList.Add(type);
                }
            }
        }

        // Метод для получения хороших шагов для движения аккордов
        private List<int> GetGoodSteps(string prevRoot, string prevType, bool isMinor)
        {
            // Общие хорошие шаги для движения аккордов в зависимости от того, мажор или минор
            if (isMinor)
            {
                return new List<int> { 3, 4, 5, 7, 8, 9 }; // Шаги, звучащие хорошо в миноре
            }
            else
            {
                return new List<int> { 5, 7, 9, 2, 4, 10 }; // Шаги, звучащие хорошо в мажоре
            }
        }

        // Метод для получения суффикса аккорда для отображения
        private string GetChordSuffix(string chordType)
        {
            switch (chordType)
            {
                case "Major": return "";
                case "Minor": return "m";
                case "Diminished": return "dim";
                case "Augmented": return "aug";
                case "Sus2": return "sus2";
                case "Sus4": return "sus4";
                case "Major7": return "maj7";
                case "Minor7": return "m7";
                case "Dominant7": return "7";
                case "Diminished7": return "dim7";
                case "Half-Diminished7": return "m7b5";
                case "Minor-Major7": return "mMaj7";
                case "Augmented7": return "aug7";
                case "Add9": return "add9";
                case "Add11": return "add11";
                case "Add13": return "add13";
                case "6": return "6";
                case "m6": return "m6";
                case "Major9": return "maj9";
                case "Minor9": return "m9";
                case "Dominant9": return "9";
                case "Major11": return "maj11";
                case "Minor11": return "m11";
                case "Dominant11": return "11";
                case "Major13": return "maj13";
                case "Minor13": return "m13";
                case "Dominant13": return "13";
                case "7b5": return "7b5";
                case "7#5": return "7#5";
                case "7b9": return "7b9";
                case "7#9": return "7#9";
                case "7#11": return "7#11";
                case "7b13": return "7b13";
                case "5": return "5";
                case "Quartal": return "quartal";
                case "Hendrix": return "7#9";
                case "So What": return "";
                default: return chordType;
            }
        }

        private void TxtNumeric_KeyPress(object sender, KeyPressEventArgs e)
        {
            if (!char.IsControl(e.KeyChar) && !char.IsDigit(e.KeyChar))
            {
                e.Handled = true;
            }
        }
        private void SetupNoteDisplayControl()
        {
            // Создаем и настраиваем контрол отображения нот
            noteDisplayControl = new NoteDisplayControl();
            noteDisplayControl.Dock = DockStyle.Fill;
            noteDisplayControl.SetDisplayMode(0); // Режим пианино-ролла

            // Добавляем контрол на панель
            panelNoteDisplay.Controls.Add(noteDisplayControl);
        }
        private void btnGenerate_Click(object sender, EventArgs e)
        {
            string selectedTonica = cmbBoxTonica.SelectedItem.ToString();
            string selectedCategory = cmbBoxCategory.SelectedItem.ToString();
            string selectedScale = cmbBoxScale.SelectedItem.ToString();
            int arpNotesCount;
            int uniqueMeasuresNumber;
            int repeatsNumber;

            if (!int.TryParse(txtArpNotesCount.Text, out arpNotesCount) || arpNotesCount <= 0)
            {
                MessageBox.Show("Введите корректное количество нот для арпеджио.", "Ошибка ввода", MessageBoxButtons.OK, MessageBoxIcon.Error);
                return;
            }

            if (!int.TryParse(txtTactsNumber.Text, out uniqueMeasuresNumber) || uniqueMeasuresNumber <= 0)
            {
                MessageBox.Show("Введите корректное количество тактов.", "Ошибка ввода", MessageBoxButtons.OK, MessageBoxIcon.Error);
                return;
            }

            if (!int.TryParse(txtRepeatsNumber.Text, out repeatsNumber) || repeatsNumber < 0)
            {
                MessageBox.Show("Введите корректное количество повторений.", "Ошибка ввода", MessageBoxButtons.OK, MessageBoxIcon.Error);
                return;
            }

            if (!scalesByCategory.ContainsKey(selectedCategory) || !scalesByCategory[selectedCategory].ContainsKey(selectedScale))
            {
                MessageBox.Show($"Гамма '{selectedScale}' в категории '{selectedCategory}' не поддерживается.", "Ошибка", MessageBoxButtons.OK, MessageBoxIcon.Error);
                return;
            }

            if (repeatsNumber > uniqueMeasuresNumber)
            {
                MessageBox.Show("Количество повторений не может превышать общее количество тактов.", "Ошибка ввода", MessageBoxButtons.OK, MessageBoxIcon.Error);
                return;
            }

            try
            {
                int totalMeasuresNumber = uniqueMeasuresNumber; // Общее количество тактов
                int actualUniqueCount = uniqueMeasuresNumber - repeatsNumber; // Количество действительно уникальных тактов

                // Проверка, чтобы уникальных тактов было хотя бы 1
                if (actualUniqueCount < 1)
                {
                    MessageBox.Show("Количество уникальных тактов должно быть не менее 1.", "Ошибка ввода", MessageBoxButtons.OK, MessageBoxIcon.Error);
                    return;
                }

                // Получаем ноты гаммы
                var scaleNotes = GetScaleNotes(selectedTonica, selectedCategory, selectedScale);

                if (scaleNotes.Count == 0)
                {
                    throw new Exception("Гамма не содержит нот.");
                }

                // Генерируем последовательность аккордов для мелодии
                var chordProgression = GenerateChordProgression(selectedTonica, selectedCategory, selectedScale, actualUniqueCount, scaleNotes);

                // Генерируем уникальные такты на основе аккордов
                var uniqueMeasures = GenerateUniqueMeasures(selectedTonica, selectedCategory, selectedScale, arpNotesCount, actualUniqueCount, chordProgression, scaleNotes);

                // Затем генерируем повторяющиеся такты на основе уникальных
                var repeatedMeasures = GenerateRepeatedMeasures(uniqueMeasures, repeatsNumber);

                // Комбинируем их, чтобы получить финальную мелодию с точным количеством тактов
                var finalMelody = CombineMeasures(uniqueMeasures, repeatedMeasures, totalMeasuresNumber);

                if (finalMelody.Count > 0)
                {
                    // Подготовим информацию об используемых аккордах
                    List<string> chordInfo = new List<string>();
                    for (int i = 0; i < chordProgression.Count; i++)
                    {
                        chordInfo.Add($"Аккорд {i + 1}: {chordProgression[i].Key}{GetChordSuffix(chordProgression[i].Value)}");
                    }

                    // ИСПРАВЛЕННАЯ ЧАСТЬ: Показываем все ноты, включая повторяющиеся, а не только уникальные
                    txtProgression.Text = string.Join("\r\n", chordInfo) + "\r\n\r\n" +
                                        string.Join("\r\n", finalMelody.Select((measure, index) =>
                                        {
                                            // Убрано Distinct() - теперь показываем все ноты по порядку
                                            var allNotes = measure.Select(n => MidiNumberToNoteName(n)).ToList();
                                            return $"Такт {index + 1}: " + string.Join(", ", allNotes);
                                        }));

                    // Отображаем ноты на контроле
                    DisplayMelodyOnNoteControl(finalMelody);

                    lastGeneratedMidiPath = SaveMelodyToMidi(finalMelody, chordProgression, selectedTonica, selectedScale, arpNotesCount);

                    btnPlayMidi.Enabled = true;
                    MessageBox.Show("MIDI файл мелодии успешно сохранен на рабочий стол.", "Успех", MessageBoxButtons.OK, MessageBoxIcon.Information);
                }
                else
                {
                    MessageBox.Show("Не удалось сгенерировать мелодию.", "Предупреждение", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                }
            }
            catch (Exception ex)
            {
                MessageBox.Show($"Произошла ошибка: {ex.Message}", "Ошибка", MessageBoxButtons.OK, MessageBoxIcon.Error);
            }
        }
        private void DisplayMelodyOnNoteControl(List<List<int>> melody)
        {
            // Количество позиций в одном такте (16 шестнадцатых нот)
            int positionsPerMeasure = 16;
            int totalPositions = melody.Count * positionsPerMeasure;

            // Создаем и инициализируем массив нулями (пусто)
            List<int> notesWithPositions = new List<int>();
            for (int i = 0; i < totalPositions; i++)
            {
                notesWithPositions.Add(0);
            }

            // Заполняем массив нотами на правильных позициях
            for (int measureIndex = 0; measureIndex < melody.Count; measureIndex++)
            {
                var measure = melody[measureIndex];

                // ВАЖНО: Распределяем ноты по 16 позициям такта
                // Если в такте 16 нот, то они идут подряд
                // Если меньше или больше - распределяем равномерно
                for (int noteIndex = 0; noteIndex < measure.Count; noteIndex++)
                {
                    // Рассчитываем позицию в такте для каждой ноты
                    int position = measureIndex * positionsPerMeasure;

                    // Если в такте ровно 16 нот, они размещаются последовательно
                    if (measure.Count == positionsPerMeasure)
                    {
                        position += noteIndex;
                    }
                    // В противном случае равномерно распределяем
                    else
                    {
                        position += (noteIndex * positionsPerMeasure) / measure.Count;
                    }

                    // Проверка границ массива
                    if (position < totalPositions)
                    {
                        notesWithPositions[position] = measure[noteIndex];
                    }
                }
            }

            // Устанавливаем ноты в контроле
            noteDisplayControl.SetNotes(notesWithPositions);

            // Прокручиваем к началу
            noteDisplayControl.ScrollToPosition(0);
        }
        private List<List<int>> GenerateRepeatedMeasures(List<List<int>> uniqueMeasures, int repeatsNumber)
        {
            var repeatedMeasures = new List<List<int>>();
            int uniqueCount = uniqueMeasures.Count;

            if (uniqueCount == 0 || repeatsNumber == 0)
                return repeatedMeasures;

            for (int i = 0; i < repeatsNumber; i++)
            {
                // Выбираем случайный такт из уникальных
                int randomIndex = random.Next(uniqueCount);
                // Создаем его копию
                var measureToRepeat = new List<int>(uniqueMeasures[randomIndex]);
                // Добавляем в список повторяющихся
                repeatedMeasures.Add(measureToRepeat);
            }

            return repeatedMeasures;
        }

        private List<List<int>> CombineMeasures(List<List<int>> uniqueMeasures, List<List<int>> repeatedMeasures, int totalMeasures)
        {
            // Создаем результирующий список с уникальными тактами
            var finalMelody = new List<List<int>>(uniqueMeasures);

            // Добавляем повторяющиеся такты в случайные позиции
            foreach (var repeat in repeatedMeasures)
            {
                int insertPosition = random.Next(finalMelody.Count + 1);
                finalMelody.Insert(insertPosition, repeat);
            }

            // Проверяем, соответствует ли количество тактов ожидаемому
            if (finalMelody.Count != totalMeasures)
            {
                throw new Exception($"Количество тактов после генерации ({finalMelody.Count}) не соответствует ожидаемому ({totalMeasures}).");
            }

            return finalMelody;
        }

        private string SaveMelodyToMidi(List<List<int>> melody, List<KeyValuePair<string, string>> chordProgression, string tonica, string scale, int arpNotesCount)
        {
            // Получаем путь к рабочему столу пользователя
            string desktopPath = Environment.GetFolderPath(Environment.SpecialFolder.Desktop);

            // Формируем имя файла с уникальной цифрой в конце
            string baseChord = chordProgression[0].Key + GetChordSuffix(chordProgression[0].Value);
            baseChord = baseChord.Replace("#", "sharp").Replace("b", "flat");

            // Добавляем уникальный идентификатор на основе текущего времени
            string uniqueId = DateTime.Now.ToString("yyyyMMddHHmmss");

            string fileName = $"{tonica}_{scale}_{baseChord}_{uniqueId}.mid";
            string fullPath = Path.Combine(desktopPath, fileName);

            // Создаем MIDI-файл
            var midiFile = new MidiEventCollection(1, 480);

            int channel = 1; // Используем канал 0
            int sixteenthNoteTicks = 120; // Длительность 16-й ноты в тиках

            // ВАЖНО: подготавливаем массив для всех нот, 16 нот на такт
            List<int> flattenedNotes = new List<int>();
            foreach (var measure in melody)
            {
                // Равномерно распределяем ноты по сетке из 16 нот
                int[] measureNotes = new int[16]; // 16 позиций для 16-х долей в такте

                for (int i = 0; i < measure.Count; i++)
                {
                    // Распределяем поступающие ноты равномерно по 16 позициям
                    int position = (i * 16) / measure.Count;
                    measureNotes[position] = measure[i];
                }

                // Добавляем ноты в плоский список
                flattenedNotes.AddRange(measureNotes);
            }

            // Теперь проходим по всем позициям и добавляем ноты в MIDI
            for (int i = 0; i < flattenedNotes.Count; i++)
            {
                int note = flattenedNotes[i];
                if (note == 0) // Пропускаем паузы
                    continue;

                // Вычисляем позицию в MIDI-тиках
                int position = i * sixteenthNoteTicks;

                // Сохраняем длительность ноты
                int noteDuration = sixteenthNoteTicks;

                // Базовая громкость (велосити)
                int velocity = 100;

                // Создаем события включения и выключения ноты с определенной длительностью
                midiFile.AddEvent(new NoteOnEvent(position, channel, note, velocity, 0), 0);
                midiFile.AddEvent(new NoteEvent(position + noteDuration, channel, MidiCommandCode.NoteOff, note, 0), 0);
            }

            // Завершаем дорожку
            midiFile.AddEvent(new MetaEvent(MetaEventType.EndTrack, 0, flattenedNotes.Count * sixteenthNoteTicks), 0);
            MidiFile.Export(fullPath, midiFile);
            return fullPath;
        }
        private void AddExpressionEvents(MidiEventCollection midiFile, int channel, int totalDuration)
        {
            // Константы контроллеров MIDI
            const byte ModulationController = 1;   // CC#1
            const byte VolumeController = 7;       // CC#7
            const byte ExpressionController = 11;  // CC#11
            const byte ReverbController = 91;      // CC#91

            // Модуляция (Modulation Wheel) - для вибрато и других эффектов
            int modulationStart = random.Next(0, totalDuration / 3);
            int modulationValue = random.Next(20, 60);
            midiFile.AddEvent(new ControlChangeEvent(modulationStart, channel, (MidiController)ModulationController, modulationValue), 0);

            // Динамические изменения (Volume и Expression)
            int volumeChange1 = random.Next(totalDuration / 4, totalDuration / 2);
            int volumeChange2 = random.Next(volumeChange1 + totalDuration / 8, totalDuration * 3 / 4);

            // Начальная громкость
            midiFile.AddEvent(new ControlChangeEvent(0, channel, (MidiController)VolumeController, 100), 0);

            // Изменения во времени
            midiFile.AddEvent(new ControlChangeEvent(volumeChange1, channel, (MidiController)VolumeController, random.Next(70, 90)), 0);
            midiFile.AddEvent(new ControlChangeEvent(volumeChange2, channel, (MidiController)VolumeController, random.Next(90, 110)), 0);

            // Expression для плавных нюансов
            int expressionChange = random.Next(totalDuration / 3, totalDuration * 2 / 3);
            midiFile.AddEvent(new ControlChangeEvent(expressionChange, channel, (MidiController)ExpressionController, random.Next(70, 90)), 0);

            // Настройка реверберации
            midiFile.AddEvent(new ControlChangeEvent(0, channel, (MidiController)ReverbController, random.Next(40, 70)), 0);
        }

        // Метод для получения MIDI номера ноты по её названию и октаве
        private int GetMidiNoteFromName(string noteName, int octave)
        {
            if (!noteOffsets.TryGetValue(noteName, out int offset))
            {
                // По умолчанию C
                offset = 0;
            }

            return (octave + 1) * 12 + offset;
        }

        // Метод для генерации нот аккорда по корневой ноте и типу
        private List<int> GenerateChordNotes(int rootNote, string chordType)
        {
            if (!chordTypes.TryGetValue(chordType, out int[] intervals))
            {
                // По умолчанию используем мажорное трезвучие
                intervals = chordTypes["Major"];
            }

            List<int> result = new List<int>();
            foreach (int interval in intervals)
            {
                result.Add(rootNote + interval);
            }

            return result;
        }

        private string MidiNumberToNoteName(int midiNumber)
        {
            string[] notesSharp = { "C", "C#", "D", "D#", "E", "F", "F#", "G", "G#", "A", "A#", "B" };
            int octave = (midiNumber / 12) - 1;
            int noteIndex = midiNumber % 12;
            return $"{notesSharp[noteIndex]}{octave}";
        }

        private List<int> GetScaleNotes(string tonica, string category, string scaleName)
        {
            // Получаем базовые интервалы лада
            var scaleIntervals = GetScaleIntervals(category, scaleName);
            if (scaleIntervals == null || scaleIntervals.Length == 0)
            {
                throw new Exception($"Лад '{scaleName}' в категории '{category}' не содержит интервалов.");
            }

            // Определяем базовую ноту (с учетом минора)
            bool isMinor = tonica.EndsWith("m");
            string baseNoteName = isMinor ? tonica.Substring(0, tonica.Length - 1) : tonica;

            if (!noteOffsets.ContainsKey(baseNoteName))
            {
                throw new Exception($"Нота '{baseNoteName}' не распознана.");
            }

            int tonicOffset = noteOffsets[baseNoteName];
            var scaleNotes = new List<int>();

            // Строим гамму для нескольких октав
            for (int octave = 3; octave <= 6; octave++)
            {
                int baseMidi = octave * 12 + tonicOffset;

                // Добавляем все ноты, включая тонику
                foreach (int interval in scaleIntervals)
                {
                    scaleNotes.Add(baseMidi + interval);
                }
            }

            // Отладочная информация - выводим ноты гаммы
            string debugScaleInfo = $"Лад: {tonica} {category}/{scaleName}, Ноты: ";
            debugScaleInfo += string.Join(", ", scaleNotes.Where(n => n >= 60 && n < 72)
                                                 .Select(n => MidiNumberToNoteName(n)));
            Debug.WriteLine(debugScaleInfo);

            return scaleNotes.OrderBy(n => n).ToList();
        }

        private List<int> GetChordNotesInScale(string rootNoteName, string chordType, int octave, List<int> scaleNotes)
        {
            // Получаем базовую ноту
            if (!noteOffsets.TryGetValue(rootNoteName, out int rootOffset))
            {
                rootOffset = 0; // По умолчанию C
            }

            int baseNote = octave * 12 + rootOffset;

            // Получаем интервалы аккорда
            if (!chordTypes.TryGetValue(chordType, out int[] chordIntervals))
            {
                chordIntervals = chordTypes["Major"]; // По умолчанию мажорное трезвучие
            }

            // Создаем список нот аккорда
            List<int> result = new List<int>();

            // Добавляем только те ноты, которые есть в гамме
            // Начинаем с корневой ноты
            int rootNoteValue = FindExactNoteInScale(baseNote, scaleNotes);
            if (rootNoteValue != -1)
            {
                result.Add(rootNoteValue);
            }
            else
            {
                // Если корневой ноты нет в гамме, ищем ближайшую
                int closest = FindClosestNoteInScale(baseNote, scaleNotes);
                if (closest != -1)
                {
                    result.Add(closest);
                }
            }

            // Добавляем остальные ноты аккорда
            foreach (int interval in chordIntervals.Skip(1)) // Пропускаем первый интервал (0)
            {
                int noteToFind = baseNote + interval;

                // Строго ищем ноту в гамме
                int noteInScale = FindExactNoteInScale(noteToFind, scaleNotes);

                if (noteInScale != -1)
                {
                    // Добавляем ноту, только если её ещё нет
                    if (!result.Contains(noteInScale))
                    {
                        result.Add(noteInScale);
                    }
                }
                else
                {
                    // Если точной ноты нет, ищем ближайшую из гаммы
                    int closest = FindClosestNoteInScale(noteToFind, scaleNotes);
                    if (closest != -1 && !result.Contains(closest))
                    {
                        result.Add(closest);
                    }
                }
            }

            // Если получилось мало нот (менее 3), добавляем ещё из гаммы
            while (result.Count < 3)
            {
                // Находим ноты в гамме, которые не входят в результат
                var availableNotes = scaleNotes.Where(n => !result.Contains(n) &&
                                                    n >= baseNote && n < baseNote + 12).ToList();

                if (availableNotes.Count == 0)
                    break;

                result.Add(availableNotes[random.Next(availableNotes.Count)]);
            }

            return result;
        }
        private int FindExactNoteInScale(int targetNote, List<int> scaleNotes)
        {
            // Прямой поиск - нота должна быть точно в гамме
            return scaleNotes.Contains(targetNote) ? targetNote : -1;
        }
        private int[] GetScaleIntervals(string category, string scaleName)
        {
            if (scalesByCategory.ContainsKey(category) && scalesByCategory[category].ContainsKey(scaleName))
            {
                return scalesByCategory[category][scaleName];
            }
            else
            {
                throw new Exception($"Интервалы для гаммы '{scaleName}' в категории '{category}' не найдены.");
            }
        }
        // Добавить этот метод для создания "базового шаблона" арпеджио
        private List<int> CreateBaseArpeggioPattern(List<int> scaleNotes, int arpNotesCount)
        {
            var basePattern = new List<int>();
            // Выбираем только ноты, которые точно есть в гамме и тонике
            var mainScaleNotes = scaleNotes.Where(n => n >= 60 && n <= 83).ToList();

            if (mainScaleNotes.Count >= 5)
            {
                // Добавляем разные ноты для создания интересного шаблона,
                // но гарантируем начало с первой ступени (тоники)
                basePattern.Add(mainScaleNotes[0]); // I ступень
                basePattern.Add(mainScaleNotes[2]); // III ступень
                basePattern.Add(mainScaleNotes[4]); // V ступень
                basePattern.Add(mainScaleNotes[0] + 12); // I ступень октавой выше (если в гамме)
            }
            else if (mainScaleNotes.Count > 0)
            {
                // Если нот меньше, используем что есть, но начинаем с тоники
                basePattern.Add(mainScaleNotes[0]); // Тоника

                for (int i = 1; i < Math.Min(4, mainScaleNotes.Count); i++)
                {
                    basePattern.Add(mainScaleNotes[i % mainScaleNotes.Count]);
                }
            }

            // Заполняем до нужного количества нот разнообразными нотами из гаммы
            while (basePattern.Count < arpNotesCount)
            {
                if (mainScaleNotes.Count > 0)
                {
                    // Выбираем случайные ноты, но стараемся избегать повторов
                    int candidate = mainScaleNotes[random.Next(mainScaleNotes.Count)];

                    // Если последняя добавленная нота отличается от кандидата или у нас мало нот
                    if (basePattern.Count == 0 || basePattern[basePattern.Count - 1] != candidate)
                    {
                        basePattern.Add(candidate);
                    }
                    else
                    {
                        // Если совпадает, ищем другую ноту
                        var otherNotes = mainScaleNotes.Where(n => n != candidate).ToList();
                        if (otherNotes.Count > 0)
                        {
                            basePattern.Add(otherNotes[random.Next(otherNotes.Count)]);
                        }
                        else
                        {
                            // Если других нот нет, добавляем октаву выше/ниже, если она в гамме
                            int octaveUp = candidate + 12;
                            int octaveDown = candidate - 12;

                            if (scaleNotes.Contains(octaveUp) && octaveUp <= 83)
                                basePattern.Add(octaveUp);
                            else if (scaleNotes.Contains(octaveDown) && octaveDown >= 60)
                                basePattern.Add(octaveDown);
                            else
                                basePattern.Add(candidate); // Если ничего не подходит, дублируем
                        }
                    }
                }
                else
                {
                    // Этот случай не должен возникать, так как scaleNotes должно быть заполнено
                    basePattern.Add(60); // C4 как запасной вариант
                }
            }

            // Проверка на разнообразие
            if (basePattern.Count > 1 && basePattern.Distinct().Count() <= 1)
            {
                // Если получились все одинаковые ноты, искусственно добавим разнообразие
                var differentNotes = scaleNotes.Where(n => n != basePattern[0] && n >= 60 && n <= 83).ToList();
                if (differentNotes.Count > 0)
                {
                    for (int i = 1; i < basePattern.Count; i += 2)
                    {
                        basePattern[i] = differentNotes[random.Next(differentNotes.Count)];
                    }
                }
            }

            return basePattern;
        }
        private List<List<int>> GenerateUniqueMeasures(string tonica, string category, string scale, int arpNotesCount, int uniqueMeasuresNumber, List<KeyValuePair<string, string>> chordProgression, List<int> scaleNotes)
        {
            var uniqueMeasures = new List<List<int>>();

            // Проверка соответствия гаммы - вывод для отладки
            var scaleNotesNames = scaleNotes.Where(n => n >= 60 && n < 72)
                                            .Select(n => MidiNumberToNoteName(n)).ToList();
            Debug.WriteLine($"Лад {tonica} {category}/{scale} - Ноты: {string.Join(", ", scaleNotesNames)}");

            // Создаем базовый шаблон арпеджио для всех тактов
            var baseArpeggioPattern = CreateBaseArpeggioPattern(scaleNotes, arpNotesCount);

            // Проверка соответствия базового шаблона гамме
            for (int i = 0; i < baseArpeggioPattern.Count; i++)
            {
                if (!scaleNotes.Contains(baseArpeggioPattern[i]))
                {
                    // Заменяем ноту, которой нет в гамме
                    int closest = FindClosestNoteInScale(baseArpeggioPattern[i], scaleNotes);
                    baseArpeggioPattern[i] = (closest != -1) ? closest : scaleNotes[random.Next(scaleNotes.Count)];
                }
            }

            // Определяем общий контур мелодии для связности произведения
            int contourType = random.Next(3);

            // Генерируем уникальные мотивы для каждого аккорда, но сохраняем общий контур
            List<List<int>> uniqueMotifs = new List<List<int>>();

            for (int i = 0; i < uniqueMeasuresNumber; i++)
            {
                // Используем аккорд из прогрессии
                var chord = chordProgression[i % chordProgression.Count];
                string rootNote = chord.Key;
                string chordType = chord.Value;

                // Создаем уникальный мотив для текущего аккорда
                var baseMotif = (i == 0) ? baseArpeggioPattern : new List<int>(baseArpeggioPattern);

                // Для второго и последующих тактов вносим больше вариаций в базовый шаблон
                if (i > 0 && uniqueMotifs.Count > 0)
                {
                    // С вероятностью каждый второй такт создаем совершенно новый мотив
                    if (i % 2 == 1 || random.NextDouble() < 0.7)
                    {
                        // Выбираем между развитием предыдущего мотива и созданием нового
                        if (random.NextDouble() < 0.6)
                        {
                            // Развиваем один из предыдущих мотивов
                            int prevIndex = random.Next(uniqueMotifs.Count);
                            baseMotif = MakeSimilarButNotIdentical(uniqueMotifs[prevIndex], scaleNotes);
                        }
                        else
                        {
                            // Создаем новый мотив на основе базового шаблона с изменениями
                            for (int j = 0; j < baseMotif.Count; j++)
                            {
                                if (random.NextDouble() < 0.5 && baseMotif[j] > 0)
                                {
                                    // Находим другие ноты в гамме
                                    var alternativeNotes = scaleNotes.Where(n => n != baseMotif[j] &&
                                                                           n >= 60 && n <= 83).ToList();
                                    if (alternativeNotes.Count > 0)
                                    {
                                        baseMotif[j] = alternativeNotes[random.Next(alternativeNotes.Count)];
                                    }
                                }
                            }
                        }
                    }
                }

                // Адаптируем мотив к аккорду и контуру
                var motif = AdaptArpeggioToChord(baseMotif, rootNote, chordType, 4, arpNotesCount,
                                                 scaleNotes, contourType, i);

                // Сохраняем уникальный мотив для будущего использования
                uniqueMotifs.Add(new List<int>(motif));

                // Генерируем такт из мотива - 16 нот для одного такта
                var measure = GenerateMeasure(motif, scaleNotes, 16);

                // Финальная проверка соответствия гамме
                for (int j = 0; j < measure.Count; j++)
                {
                    if (measure[j] > 0 && !scaleNotes.Contains(measure[j]))
                    {
                        int closest = FindClosestNoteInScale(measure[j], scaleNotes);
                        measure[j] = (closest != -1) ? closest : scaleNotes[random.Next(scaleNotes.Count)];
                    }
                }

                uniqueMeasures.Add(measure);
            }

            return uniqueMeasures;
        }
        private List<int> GenerateMeasure(List<int> motif, List<int> scaleNotes, int totalNotes)
        {
            var measure = new List<int>();

            // Добавляем больше вариативности - выбираем случайный ритмический паттерн
            int rhythmPattern = random.Next(7); // Больше вариантов паттернов
            bool useRhythmicAccents = random.NextDouble() < 0.8; // Чаще используем акценты

            // Дополнительная проверка мотива: все ноты должны быть в гамме
            List<int> correctedMotif = motif.Select(note =>
            {
                if (note == 0 || scaleNotes.Contains(note)) return note;
                // Если нота не в гамме, заменяем ближайшей
                int closest = FindClosestNoteInScale(note, scaleNotes);
                return closest != -1 ? closest : scaleNotes[random.Next(scaleNotes.Count)];
            }).ToList();

            // Проверка на монотонность
            bool isMonotonous = true;
            int firstNonZero = correctedMotif.FirstOrDefault(n => n > 0);

            if (firstNonZero > 0)
            {
                foreach (var note in correctedMotif)
                {
                    if (note > 0 && note != firstNonZero)
                    {
                        isMonotonous = false;
                        break;
                    }
                }

                if (isMonotonous)
                {
                    // Генерируем новый, более разнообразный мотив
                    var availableNotes = scaleNotes.Where(n => n >= 60 && n <= 83 && n != firstNonZero).ToList();
                    if (availableNotes.Count >= 2)
                    {
                        // Берём случайные ноты из гаммы для разнообразия
                        for (int i = 0; i < correctedMotif.Count; i++)
                        {
                            // Каждую вторую ноту делаем другой
                            if (i % 2 == 1 && correctedMotif[i] > 0)
                            {
                                int index = random.Next(availableNotes.Count);
                                correctedMotif[i] = availableNotes[index];
                            }
                        }
                    }
                }
            }

            // Определяем, сколько раз нужно повторить мотив
            int motifCount = totalNotes / correctedMotif.Count;
            int remainder = totalNotes % correctedMotif.Count;

            // Добавляем элемент случайности для каждого повторения
            double uniquenessMultiplier = 0.8 + (random.NextDouble() * 0.2); // Увеличиваем: 80-100% шанс вариации

            for (int i = 0; i < motifCount; i++)
            {
                List<int> currentMotif;

                // Для первого мотива берём исходный или вносим небольшую вариацию
                if (i == 0)
                {
                    if (random.NextDouble() < 0.4) // Увеличиваем с 0.3 до 0.4
                    {
                        currentMotif = MakeSimilarButNotIdentical(correctedMotif, scaleNotes);
                    }
                    else
                    {
                        currentMotif = new List<int>(correctedMotif);
                    }
                }
                else
                {
                    // Для последующих мотивов увеличиваем шанс вариации
                    if (random.NextDouble() < uniquenessMultiplier)
                    {
                        currentMotif = MakeSimilarButNotIdentical(correctedMotif, scaleNotes);

                        // Иногда инвертируем мотив для большего разнообразия
                        if (random.NextDouble() < 0.4) // Увеличиваем с 0.3 до 0.4
                        {
                            currentMotif.Reverse();
                        }

                        // Иногда смещаем (ротируем) мотив
                        if (random.NextDouble() < 0.4 && currentMotif.Count > 2) // Увеличиваем с 0.3 до 0.4
                        {
                            int rotateBy = random.Next(1, currentMotif.Count);
                            var rotated = new List<int>();
                            for (int j = 0; j < currentMotif.Count; j++)
                            {
                                rotated.Add(currentMotif[(j + rotateBy) % currentMotif.Count]);
                            }
                            currentMotif = rotated;
                        }
                    }
                    else
                    {
                        currentMotif = new List<int>(correctedMotif);
                    }
                }

                // Применяем ритмические вариации в зависимости от выбранного паттерна
                ApplyRhythmicVariation(currentMotif, rhythmPattern, useRhythmicAccents, i);

                // Случайно чередуем артикуляцию
                if (random.NextDouble() < 0.3) // Увеличиваем с 0.2 до 0.3
                {
                    ApplyArticulationVariation(currentMotif);
                }

                measure.AddRange(currentMotif);
            }

            // Добавляем оставшиеся ноты
            if (remainder > 0)
            {
                var remainingMotif = correctedMotif.Take(remainder).ToList();

                // Делаем вариацию оставшихся нот, чтобы избежать повторения
                if (random.NextDouble() < 0.5 && scaleNotes.Count > 0)
                {
                    for (int i = 0; i < remainingMotif.Count; i++)
                    {
                        if (remainingMotif[i] > 0 && random.NextDouble() < 0.6)
                        {
                            var alternatives = scaleNotes.Where(n =>
                                n != remainingMotif[i] &&
                                n >= 60 && n <= 83).ToList();

                            if (alternatives.Count > 0)
                            {
                                remainingMotif[i] = alternatives[random.Next(alternatives.Count)];
                            }
                        }
                    }
                }

                measure.AddRange(remainingMotif);
            }

            // Финальная проверка на соответствие гамме
            for (int i = 0; i < measure.Count; i++)
            {
                if (measure[i] > 0 && !scaleNotes.Contains(measure[i]))
                {
                    int closest = FindClosestNoteInScale(measure[i], scaleNotes);
                    measure[i] = (closest != -1) ? closest : scaleNotes[random.Next(scaleNotes.Count)];
                }
            }

            // Финальная проверка на монотонность всего такта
            var nonZeroNotes = measure.Where(n => n > 0).ToList();
            if (nonZeroNotes.Count > 1)
            {
                // Считаем, сколько раз встречается каждая нота
                var noteCounts = nonZeroNotes.GroupBy(n => n)
                                            .Select(g => new { Note = g.Key, Count = g.Count() });

                // Если какая-то нота встречается более 50% от всех нот
                var mostCommon = noteCounts.OrderByDescending(g => g.Count).FirstOrDefault();
                if (mostCommon != null && (double)mostCommon.Count / nonZeroNotes.Count > 0.5)
                {
                    // Заменяем часть этих нот на другие из гаммы
                    var alternativeNotes = scaleNotes.Where(n =>
                        n != mostCommon.Note &&
                        n >= 60 && n <= 83).ToList();

                    if (alternativeNotes.Count > 0)
                    {
                        for (int i = 0; i < measure.Count; i++)
                        {
                            if (measure[i] == mostCommon.Note && random.NextDouble() < 0.7)
                            {
                                measure[i] = alternativeNotes[random.Next(alternativeNotes.Count)];
                            }
                        }
                    }
                }
            }

            return measure;
        }
        private void ApplyArticulationVariation(List<int> motif)
        {
            int articulationType = random.Next(3);

            switch (articulationType)
            {
                case 0: // Добавление пауз
                    if (motif.Count >= 4)
                    {
                        // Заменяем некоторые ноты паузами (0)
                        int pauseCount = 1 + random.Next(motif.Count / 3);
                        for (int i = 0; i < pauseCount; i++)
                        {
                            int index = 1 + random.Next(motif.Count - 2); // Не первую и не последнюю ноту
                            motif[index] = 0; // Пауза
                        }
                    }
                    break;

                case 1: // Повтор некоторых нот
                    if (motif.Count >= 3)
                    {
                        int repeatIndex = random.Next(motif.Count);
                        if (repeatIndex < motif.Count - 1 && motif[repeatIndex] > 0)
                        {
                            motif[repeatIndex + 1] = motif[repeatIndex];
                        }
                    }
                    break;

                case 2: // Добавление акцентов (октавный скачок)
                    if (motif.Count >= 3)
                    {
                        int accentIndex = random.Next(motif.Count);
                        if (motif[accentIndex] > 0)
                        {
                            if (random.NextDouble() < 0.5)
                                motif[accentIndex] += 12; // Вверх на октаву
                            else
                                motif[accentIndex] = Math.Max(motif[accentIndex] - 12, 48); // Вниз на октаву, но не ниже C3
                        }
                    }
                    break;
            }
        }

        private void ApplyRhythmicVariation(List<int> motif, int patternType, bool useAccents, int position)
        {
            if (motif.Count <= 1) return;

            switch (patternType)
            {
                case 0: // Акценты на сильных долях
                    if (useAccents && position % 2 == 0)
                    {
                        for (int i = 0; i < motif.Count; i++)
                        {
                            if (i % 2 == 0 && motif[i] > 0) // Акцентируем каждую первую и третью долю
                            {
                                if (random.NextDouble() < 0.7)
                                    motif[i] += 12; // Подъем на октаву для акцента
                            }
                        }
                    }
                    break;

                case 1: // Синкопы
                    if (motif.Count >= 3 && useAccents)
                    {
                        for (int i = 1; i < motif.Count; i += 2)
                        {
                            if (motif[i] > 0) // Акцентируем слабые доли
                            {
                                if (random.NextDouble() < 0.6)
                                    motif[i] += 7; // Подъем на квинту для акцента
                            }
                        }
                    }
                    break;

                case 2: // Триоли - группируем по 3
                    if (motif.Count >= 3)
                    {
                        for (int i = 0; i < motif.Count; i++)
                        {
                            if (i % 3 == 0 && motif[i] > 0 && useAccents)
                            {
                                if (random.NextDouble() < 0.5)
                                    motif[i] += 4; // Подъем на терцию для первой ноты в группе
                            }
                        }
                    }
                    break;

                case 3: // Паузы (заменяем некоторые ноты на паузы, обозначенные как 0)
                    if (motif.Count >= 4)
                    {
                        int pauseIdx = random.Next(1, motif.Count);
                        if (random.NextDouble() < 0.3)
                            motif[pauseIdx] = 0; // 0 означает паузу
                    }
                    break;

                case 4: // Стаккато/легато эффект
                        // Этот эффект будет применен в методе SaveMelodyToMidi при экспорте
                    break;
            }
        }

        // Добавить новый метод для адаптации арпеджио к аккорду, сохраняя контур
        private List<int> AdaptArpeggioToChord(List<int> basePattern, string rootNote, string chordType, int octave, int arpNotesCount, List<int> scaleNotes, int contourType, int positionInProgression)
        {
            // Получаем ТОЛЬКО ноты аккорда, которые входят в гамму
            var chordNotes = GetChordNotesInScale(rootNote, chordType, octave, scaleNotes);

            // Получаем "проходящие ноты" - ноты из гаммы, которые не входят в аккорд
            var passingNotes = scaleNotes.Where(n => n >= 60 && n <= 83 && !chordNotes.Contains(n)).ToList();

            // Создаем расширенный набор нот для более разнообразного арпеджио
            var extendedNotes = new List<int>(chordNotes);

            // Добавляем некоторые проходящие ноты к набору, но с меньшим приоритетом
            if (passingNotes.Count > 0)
            {
                // Добавляем только некоторые, чтобы сохранить "характер" аккорда
                int passingToAdd = Math.Min(3, passingNotes.Count);
                for (int i = 0; i < passingToAdd; i++)
                {
                    int idx = random.Next(passingNotes.Count);
                    extendedNotes.Add(passingNotes[idx]);
                    passingNotes.RemoveAt(idx);
                }
            }

            // Если не удалось получить ноты аккорда, используем ноты гаммы
            if (chordNotes.Count == 0)
            {
                int rootMidi = octave * 12;
                if (noteOffsets.TryGetValue(rootNote, out int offset))
                {
                    rootMidi += offset;
                }

                // Берем ноты гаммы вокруг корневой ноты
                chordNotes = scaleNotes.Where(n => n >= rootMidi && n < rootMidi + 12).ToList();

                // Если всё равно нет нот, берем любые из гаммы
                if (chordNotes.Count == 0)
                {
                    chordNotes = scaleNotes.Where(n => n >= 60 && n <= 83).ToList();
                }

                // В этом случае extendedNotes = chordNotes
                extendedNotes = new List<int>(chordNotes);
            }

            // Убеждаемся, что у нас есть ноты для работы
            if (chordNotes.Count == 0)
            {
                throw new Exception("Не удалось найти ноты в гамме для создания арпеджио.");
            }

            // Создаем копию базового шаблона для адаптации
            List<int> result = new List<int>(basePattern);

            // Для первого такта используем корневую ноту аккорда
            if (positionInProgression == 0 && chordNotes.Count > 0)
            {
                result[0] = chordNotes[0];
            }

            // Заполняем оставшиеся позиции нотами из аккорда/гаммы
            for (int i = (positionInProgression == 0) ? 1 : 0; i < result.Count; i++)
            {
                // Определяем, использовать ли расширенный набор или только ноты аккорда
                bool useExtended = random.NextDouble() < 0.4; // 40% шанс использовать проходящую ноту
                var sourceNotes = (useExtended && extendedNotes.Count > chordNotes.Count) ? extendedNotes : chordNotes;

                if (i < sourceNotes.Count)
                {
                    result[i] = sourceNotes[i];
                }
                else if (sourceNotes.Count > 0)
                {
                    // Избегаем повторов, чередуя ноты
                    int index = (i % sourceNotes.Count);
                    result[i] = sourceNotes[index];

                    // Если последняя нота такая же, и у нас есть другие ноты,
                    // используем другую ноту
                    if (i > 0 && result[i] == result[i - 1] && sourceNotes.Count > 1)
                    {
                        // Перебираем ноты, пока не найдем отличающуюся
                        for (int j = 1; j < sourceNotes.Count; j++)
                        {
                            int altIndex = (index + j) % sourceNotes.Count;
                            if (sourceNotes[altIndex] != result[i - 1])
                            {
                                result[i] = sourceNotes[altIndex];
                                break;
                            }
                        }
                    }
                }
            }

            // Применяем контур мелодии
            ApplyContour(result, contourType, positionInProgression);

            // Добавляем скачки для большего мелодического интереса
            for (int i = 1; i < result.Count; i++)
            {
                // Создаем мелодические скачки каждые 2-3 ноты
                if (i % 3 == 0 && random.NextDouble() < 0.6)
                {
                    // Находим ноты, которые будут создавать скачок (терция, кварта, квинта и т.д.)
                    var jumpCandidates = scaleNotes.Where(n =>
                        (Math.Abs(n - result[i - 1]) >= 4) && // Минимум терция
                        (Math.Abs(n - result[i - 1]) <= 9) && // Максимум секста
                        n >= 60 && n <= 83).ToList();

                    if (jumpCandidates.Count > 0)
                    {
                        result[i] = jumpCandidates[random.Next(jumpCandidates.Count)];
                    }
                }
            }

            // СТРОГО проверяем, что все ноты входят в гамму
            for (int i = 0; i < result.Count; i++)
            {
                if (!scaleNotes.Contains(result[i]))
                {
                    // Если нота не в гамме, заменяем её на ближайшую из гаммы
                    int closest = FindClosestNoteInScale(result[i], scaleNotes);
                    result[i] = (closest != -1) ? closest : scaleNotes[0];
                }
            }

            // Проверка и исправление монотонности
            if (result.Count > 1)
            {
                // Проверяем, сколько уникальных нот в результате
                int uniqueCount = result.Distinct().Count();

                if (uniqueCount <= 1)
                {
                    // Сильная монотонность - заменяем каждую вторую ноту
                    for (int i = 1; i < result.Count; i += 2)
                    {
                        var alternativeNotes = scaleNotes.Where(n =>
                            n != result[0] &&
                            n >= 60 && n <= 83 &&
                            chordNotes.Contains(n)).ToList();

                        if (alternativeNotes.Count > 0)
                        {
                            result[i] = alternativeNotes[random.Next(alternativeNotes.Count)];
                        }
                        else
                        {
                            // Если нет альтернатив в аккорде, используем ноты из гаммы
                            var anyAlternatives = scaleNotes.Where(n => n != result[0] && n >= 60 && n <= 83).ToList();
                            if (anyAlternatives.Count > 0)
                            {
                                result[i] = anyAlternatives[random.Next(anyAlternatives.Count)];
                            }
                        }
                    }
                }
                else if (uniqueCount < 3 && result.Count >= 4)
                {
                    // Умеренная монотонность - заменяем некоторые ноты
                    var mostCommonNote = result.GroupBy(n => n)
                                               .OrderByDescending(g => g.Count())
                                               .First().Key;

                    // Находим позиции, где эта нота повторяется последовательно
                    for (int i = 1; i < result.Count; i++)
                    {
                        if (result[i] == mostCommonNote && result[i - 1] == mostCommonNote)
                        {
                            // Заменяем вторую ноту из каждой пары одинаковых нот
                            var alternativeNotes = scaleNotes.Where(n =>
                                n != mostCommonNote &&
                                n >= 60 && n <= 83 &&
                                (chordNotes.Contains(n) || random.NextDouble() < 0.5)).ToList();

                            if (alternativeNotes.Count > 0)
                            {
                                result[i] = alternativeNotes[random.Next(alternativeNotes.Count)];
                            }
                        }
                    }
                }
            }

            // Финальная проверка - все ноты должны быть в гамме
            Debug.Assert(result.All(n => scaleNotes.Contains(n)), "Не все ноты входят в выбранный лад!");

            return result;
        }
        private void ApplyContour(List<int> notes, int contourType, int positionInProgression)
        {
            if (notes.Count <= 1) return;

            // Сортируем ноты для создания нужного контура
            List<int> sortedNotes = new List<int>(notes);
            sortedNotes.Sort();

            switch (contourType)
            {
                case 0: // Восходящий контур
                        // Для более поздних позиций в прогрессии делаем контур более выраженным
                    for (int i = 0; i < notes.Count; i++)
                    {
                        // Постепенное усиление контура с каждой позицией
                        int adjustedIndex = Math.Min(i + positionInProgression / 2, sortedNotes.Count - 1);
                        notes[i] = sortedNotes[adjustedIndex];
                    }
                    break;

                case 1: // Нисходящий контур
                    for (int i = 0; i < notes.Count; i++)
                    {
                        int adjustedIndex = Math.Min(notes.Count - 1 - i + positionInProgression / 2, sortedNotes.Count - 1);
                        notes[i] = sortedNotes[adjustedIndex];
                    }
                    break;

                case 2: // Волнообразный контур
                    for (int i = 0; i < notes.Count; i++)
                    {
                        // Для четных позиций - выше, для нечетных - ниже
                        int direction = (i % 2 == 0) ? 1 : -1;
                        int middleIndex = sortedNotes.Count / 2;
                        int offset = Math.Min(i / 2 + positionInProgression / 3, middleIndex);

                        int index = middleIndex + direction * offset;
                        index = Clamp(index, 0, sortedNotes.Count - 1);

                        notes[i] = sortedNotes[index];
                    }
                    break;
            }
        }
        private void BtnPlayMidi_Click(object sender, EventArgs e)
        {
            if (string.IsNullOrEmpty(lastGeneratedMidiPath) || !File.Exists(lastGeneratedMidiPath))
            {
                MessageBox.Show("Нет сгенерированного MIDI-файла для воспроизведения.", "Ошибка", MessageBoxButtons.OK, MessageBoxIcon.Error);
                return;
            }

            try
            {
                ProcessStartInfo startInfo = new ProcessStartInfo
                {
                    FileName = lastGeneratedMidiPath,
                    UseShellExecute = true
                };
                Process.Start(startInfo);
            }
            catch (Exception ex)
            {
                MessageBox.Show($"Не удалось воспроизвести MIDI-файл: {ex.Message}", "Ошибка", MessageBoxButtons.OK, MessageBoxIcon.Error);
            }
        }

        private int Clamp(int value, int min, int max)
        {
            if (value < min) return min;
            if (value > max) return max;
            return value;
        }

        // Новый метод для обработки изменения режима отображения на клавиатуру
        private void rbKeyboard_CheckedChanged(object sender, EventArgs e)
        {
            if (rbKeyboard.Checked)
            {
                noteDisplayControl.SetDisplayMode(0); // Режим клавиатуры
            }
        }

        // Новый метод для обработки изменения режима отображения на нотный стан
        private void rbStaff_CheckedChanged(object sender, EventArgs e)
        {
            if (rbStaff.Checked)
            {
                noteDisplayControl.SetDisplayMode(1); // Режим нотного стана
            }
        }

        private void Form1_Resize(object sender, EventArgs e)
        {
            // При необходимости можно добавить дополнительную логику
        }

    }
}